import{j as e,m as h,i as G,a3 as b,s as E,f as $,z as A,Y as B}from"./chunk-v5-1760918235214-Bi4eP96q.js";import{r as i,u as I}from"./chunk-v5-1760918235214-DzTHeiPn.js";import{b as Z,s as D,d as K}from"./chunk-v5-1760918235214-BIi937mW.js";import{b as O}from"./chunk-v5-1760918235214-YYw7dtO2.js";import"./chunk-v5-1760918235214-DEEGuDNL.js";import"./chunk-v5-1760918235214-67jeV4qK.js";const P=({message:a="Učitavanje...",size:l="medium"})=>{const c={small:"w-4 h-4",medium:"w-8 h-8",large:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:`animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 ${c[l]}`}),a&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:a})]})},V=({message:a,isOpen:l,duration:c=2500,onClose:m,type:y="info"})=>{if(i.useEffect(()=>{if(!l)return;const x=setTimeout(()=>{m&&m()},c);return()=>clearTimeout(x)},[l,c,m]),!l)return null;const n={info:"bg-blue-600",success:"bg-emerald-600",error:"bg-red-600",warning:"bg-yellow-500"};return e.jsx("div",{className:"fixed bottom-6 left-1/2 z-50 transform -translate-x-1/2 flex items-center justify-center",children:e.jsx("div",{className:`px-6 py-3 rounded-xl shadow-lg text-white font-semibold transition-all duration-300 ${n[y]||n.info}`,role:"status",children:a})})};function X(){const a=O(),l=I(),[c,m]=i.useState([]),[y,n]=i.useState(!0),[x,N]=i.useState(null),[u,f]=i.useState({open:!1,message:"",type:"info"}),[w,v]=i.useState(null),[g,k]=i.useState({isOpen:!1,url:null,fileName:null}),[r,z]=i.useState(null);i.useEffect(()=>{if(!a){l("/");return}if(a.driverRole==="admin"||a.isAdmin){v("Admini nemaju pristup platnim listama"),n(!1);return}if(!a.driverName){n(!1);return}(async()=>{try{const{data:s,error:o}=await D.from("drivers").select("ime, tura").eq("ime",a.driverName.trim()).eq("deleted",0).single();!o&&s&&z(s)}catch{}})(),C(a.driverName.trim().toLowerCase())},[a,l]);const[q,R]=i.useState(""),C=async t=>{try{n(!0),console.warn("Google Drive API ključ nije postavljen, koristim mock podatke"),F();return}catch(s){console.error("Greška pri učitavanju platnih lista:",s),v("Greška pri učitavanju platnih lista iz Google Drive"),n(!1)}},F=()=>{const t=[{id:"1",month:"01/2025",fileName:"01/2025.pdf",fileId:"mock_file_id_1",downloadUrl:"#",uploadDate:"2025-01-15T10:30:00.000Z",size:"245 KB"},{id:"2",month:"02/2025",fileName:"02/2025.pdf",fileId:"mock_file_id_2",downloadUrl:"#",uploadDate:"2025-02-15T10:30:00.000Z",size:"251 KB"},{id:"3",month:"03/2025",fileName:"03/2025.pdf",fileId:"mock_file_id_3",downloadUrl:"#",uploadDate:"2025-03-15T10:30:00.000Z",size:"238 KB"}];setTimeout(()=>{m(t),n(!1)},1e3)},S=async t=>{try{N(t.id);const s=r!=null&&r.ime?r.ime.trim().toLowerCase():a.driverName.trim().toLowerCase();await K(s,t.name||t.fileName),f({open:!0,type:"success",message:`Platna lista ${t.name||t.fileName} je uspješno preuzeta!`})}catch(s){console.error("Greška pri preuzimanju:",s),f({open:!0,type:"error",message:"Greška pri preuzimanju platne liste"})}finally{N(null)}},_=async t=>{const s=r!=null&&r.ime?r.ime.trim().toLowerCase():a.driverName.trim().toLowerCase();console.log("[viewPayroll] folder:",s,"file:",t.name);const{data:o,error:p}=await D.storage.from("payrolls").createSignedUrl(`${s}/${t.name}`,60);console.log("[viewPayroll] Supabase result:",{data:o,error:p});const d=o==null?void 0:o.signedUrl;d?k({isOpen:!0,url:d,fileName:t.name}):f({open:!0,type:"error",message:"PDF nije pronađen ili nije moguće prikazati."})},L=t=>new Date(t).toLocaleDateString("bs-BA",{day:"2-digit",month:"2-digit",year:"numeric"}),U=[...c].sort((t,s)=>{const o=T=>{const j=T.name.match(/(\d{2})_(\d{4})/);return j?{year:parseInt(j[2]),month:parseInt(j[1])}:{year:0,month:0}},p=o(t),d=o(s);return p.year!==d.year?d.year-p.year:d.month-p.month});return y?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 flex items-center justify-center",children:e.jsxs(h.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[e.jsx(P,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Učitavam platne liste..."})]})}):w?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 flex items-center justify-center",children:e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-xl p-8 text-center max-w-md mx-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl",children:"⚠️"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Greška"}),e.jsx("p",{className:"text-gray-600 mb-6",children:w}),e.jsx("button",{className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>l("/"),children:"Nazad na početnu"})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[e.jsx(h.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/60 p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center gap-4",children:[e.jsxs("button",{className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition-colors",onClick:()=>l("/"),children:[e.jsx(G,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Nazad"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(b,{className:"w-6 h-6 text-blue-600"}),"Platne Liste"]}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(E,{className:"w-4 h-4"}),"Vozač: ",e.jsx("strong",{children:(r==null?void 0:r.ime)||(a==null?void 0:a.name)||(a==null?void 0:a.driverName)}),r!=null&&r.tura?e.jsxs("span",{className:"text-sm",children:["(",r.tura,")"]}):null]})]})]})}),e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:c.length===0?e.jsxs(h.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-sm p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(b,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Nema dostupnih platnih lista"}),e.jsx("p",{className:"text-gray-600",children:"Trenutno nema uploadovanih platnih lista za vaš ID vozača."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:U.map((t,s)=>e.jsx(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:s*.1},className:"bg-white rounded-2xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm font-medium",children:[e.jsx($,{className:"w-4 h-4"}),t.month]}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:t.size})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-2xl flex items-center justify-center mx-auto mb-3",children:e.jsx(b,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"font-semibold text-gray-800 mb-1",children:t.name}),t.created_at&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Uploaded: ",L(t.created_at)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 bg-blue-50 text-blue-600 py-2 px-4 rounded-lg hover:bg-blue-100 transition-colors",onClick:()=>_(t),title:"Prikaži PDF",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Prikaži"})]}),e.jsx("button",{className:`flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-lg transition-colors ${x===t.id?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-green-50 text-green-600 hover:bg-green-100"}`,onClick:()=>S(t),disabled:x===t.id,children:x===t.id?e.jsxs(e.Fragment,{children:[e.jsx(P,{size:"small"}),e.jsx("span",{className:"text-sm",children:"Preuzimam..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Preuzmi"})]})})]})]})},t.id))})}),u.open&&e.jsx(V,{isOpen:u.open,message:u.message,type:u.type,onClose:()=>f({...u,open:!1})}),g.isOpen&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full p-6 relative flex flex-col",children:[e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-xl",onClick:()=>k({isOpen:!1,url:null,fileName:null}),title:"Zatvori",children:"×"}),e.jsx("h3",{className:"text-lg font-bold mb-4",children:g.fileName||"PDF Dokument"}),e.jsx("iframe",{src:g.url,className:"w-full h-[70vh] border rounded-lg",title:g.fileName||"PDF Dokument",frameBorder:"0"})]})})]})}export{X as default};

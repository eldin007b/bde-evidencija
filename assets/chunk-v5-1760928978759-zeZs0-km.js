import{j as e,m as W,i as $e,N as et}from"./chunk-v5-1760928978759-BVLivFZE.js";import{r as h,a as tt,R as Z,u as st}from"./chunk-v5-1760928978759-DzTHeiPn.js";import{u as rt,a as Oe,C as ot,M as at,T as nt,b as De,P as He,L as le}from"./chunk-v5-1760928978759-BsE84rb5.js";const Ve={VITE_MAPQUEST_PROXY_URL:"https://dsltpiupbfopyvuiqffg.supabase.co/functions/v1/mapquest-proxy",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzbHRwaXVwYmZvcHl2dWlxZmZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5Mjc3MzcsImV4cCI6MjA2NTUwMzczN30.suu_OSbTBSEkM3YMiPDFIAgDnX3bDavcD8BX4ZfYZxw",VITE_SUPABASE_URL:"https://dsltpiupbfopyvuiqffg.supabase.co"};var Ge={};const A=typeof import.meta<"u"&&Ve?Ve:{},k=typeof process<"u"&&Ge?Ge:{},it="https://dsltpiupbfopyvuiqffg.supabase.co",lt="",ct="https://dsltpiupbfopyvuiqffg.supabase.co/functions/v1",M={SUPABASE_URL:A.VITE_SUPABASE_URL||A.REACT_APP_SUPABASE_URL||k.REACT_APP_SUPABASE_URL||it,SUPABASE_KEY:A.VITE_SUPABASE_ANON_KEY||A.VITE_SUPABASE_KEY||A.REACT_APP_SUPABASE_KEY||k.REACT_APP_SUPABASE_KEY||lt,API_BASE_URL:A.VITE_API_BASE_URL||A.REACT_APP_API_BASE_URL||k.REACT_APP_API_BASE_URL||ct,GOOGLE_MAPS_API_KEY:A.VITE_GOOGLE_MAPS_API_KEY||A.REACT_APP_GOOGLE_MAPS_API_KEY||k.REACT_APP_GOOGLE_MAPS_API_KEY||"",GOOGLE_DRIVE_API_KEY:A.VITE_GOOGLE_DRIVE_API_KEY||k.VITE_GOOGLE_DRIVE_API_KEY||"",GOOGLE_DRIVE_FOLDER_ID:A.VITE_GOOGLE_DRIVE_FOLDER_ID||k.VITE_GOOGLE_DRIVE_FOLDER_ID||""};M.MAPQUEST_API_KEY=A.VITE_MAPQUEST_API_KEY||A.REACT_APP_MAPQUEST_API_KEY||k.REACT_APP_MAPQUEST_API_KEY||"";M.MAPQUEST_PROXY_URL=A.VITE_MAPQUEST_PROXY_URL||A.REACT_APP_MAPQUEST_PROXY_URL||k.REACT_APP_MAPQUEST_PROXY_URL||`${M.API_BASE_URL}/mapquest-proxy`;M.GITHUB_TOKEN=A.VITE_GITHUB_TOKEN||A.REACT_APP_GITHUB_TOKEN||k.REACT_APP_GITHUB_TOKEN||"";M.GITHUB_REPO=A.VITE_GITHUB_REPO||A.REACT_APP_GITHUB_REPO||k.REACT_APP_GITHUB_REPO||"eldin007b/gls-scraper";M.WORKFLOW_FILE=A.VITE_WORKFLOW_FILE||A.REACT_APP_WORKFLOW_FILE||k.REACT_APP_WORKFLOW_FILE||"scraper.yml";M.ROUTE_STRATEGY=A.VITE_ROUTE_STRATEGY||A.REACT_APP_ROUTE_STRATEGY||k.REACT_APP_ROUTE_STRATEGY||"";M.VORANACHB_URL=A.VITE_VORANACHB_URL||A.REACT_APP_VORANACHB_URL||k.REACT_APP_VORANACHB_URL||"";async function dt(s){var o,n,i,l;const t={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:14289510,y:46624050,acc:16.185}},formatted:!1,ext:"VAO.22",svcReqL:[{meth:"LocMatch",req:{input:{field:"S",loc:{type:"ALL",dist:1e3,name:s},maxLoc:7}},id:"1|43|"}]};try{const u=await fetch(`${M.API_BASE_URL}/vor-proxy`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});console.debug("[AddressSearchService] vor-proxy status:",u.status);try{const m=await u.text();console.debug("[AddressSearchService] vor-proxy response (preview):",m.slice(0,1e3));const v=m?JSON.parse(m):null;return((l=(i=(n=(o=v==null?void 0:v.svcResL)==null?void 0:o[0])==null?void 0:n.res)==null?void 0:i.match)==null?void 0:l.locL)||[]}catch(m){console.warn("[AddressSearchService] Failed to parse vor-proxy response as JSON",m)}}catch(u){console.warn("VAO proxy failed, falling back to Nominatim",u)}try{const u=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(s)}&format=json&addressdetails=1&limit=8&accept-language=de`,m=await fetch(u,{headers:{"User-Agent":"bde-evidencija/1.0 (+https://eldin007b.github.io/bde-evidencija)"}});return m.ok?(await m.json()).map(a=>({name:a.display_name,nameFormatted:{text:a.display_name},crd:{x:Math.round(a.lon*1e6),y:Math.round(a.lat*1e6)}})):[]}catch(u){return console.warn("Nominatim fallback failed",u),[]}}function Ke(s){var i;if(s.info.statuscode!==0){const l={400:"Bad request",401:"Unauthorized - check API key",403:"Forbidden",500:"MapQuest server error"};throw new Error(`MapQuest API error ${s.info.statuscode}: ${l[s.info.statuscode]||((i=s.info.messages)==null?void 0:i.join(", "))||"Unknown error"}`)}const t=s.route;if(!t)throw new Error("No route data received from MapQuest");const o=Math.round(t.distance*1e3),n=Math.round(t.time);return{distanceMeters:o,distanceText:xt(o),durationSeconds:n,durationText:pt(n),mapQuestData:{fuelUsed:t.fuelUsed,realTime:t.hasRealTime,sessionId:t.sessionId}}}async function ut(s,t,o,n){return await ht(s,t,o,n)}async function ht(s,t,o,n){if(M.MAPQUEST_PROXY_URL)try{return await mt(s,t,o,n)}catch{}try{return await gt(s,t,o,n)}catch(i){throw new Error(`Both MapQuest methods failed. Proxy: ${(proxyError==null?void 0:proxyError.message)||"not available"}, Direct: ${i.message}`)}}async function mt(s,t,o,n){try{const i={locations:[{latLng:{lat:s,lng:t}},{latLng:{lat:o,lng:n}}],options:{routeType:"fastest",unit:"k",doReverseGeocode:!1,enhancesNarratives:!1,avoidTimedConditions:!1}},l=M.MAPQUEST_PROXY_URL||`${M.API_BASE_URL}/mapquest-proxy`,u=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!u.ok)throw new Error(`MapQuest proxy error: ${u.status} - ${u.statusText}`);const m=await u.json();return Ke(m)}catch(i){throw i}}async function gt(s,t,o,n){const i=M.MAPQUEST_API_KEY;if(!i||i==="your_mapquest_key_here")throw new Error("MapQuest API key not configured");try{const l=`https://www.mapquestapi.com/directions/v2/route?key=${encodeURIComponent(i)}`,m=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locations:[{latLng:{lat:s,lng:t}},{latLng:{lat:o,lng:n}}],options:{routeType:"fastest",unit:"k",doReverseGeocode:!1,enhancesNarratives:!1,avoidTimedConditions:!1}})});if(!m.ok)throw new Error(`MapQuest API error: ${m.status} - ${m.statusText}`);const v=await m.json();return Ke(v)}catch(l){throw l}}function xt(s){if(s==null)return null;if(s>=1e3){const t=s/1e3;return new Intl.NumberFormat("de-DE",{maximumFractionDigits:1}).format(t)+" km"}return`${s} m`}function pt(s){if(s==null)return null;const t=Math.round(s/60);if(t>=60){const o=Math.floor(t/60),n=t%60;return n>0?`${o}h ${n}min`:`${o}h`}return`${t} min`}function re(s){if(s==null)return null;if(s>=1e3){const t=s/1e3;return new Intl.NumberFormat("de-DE",{maximumFractionDigits:1}).format(t)+" km"}return`${s} m`}function oe(s){if(s==null)return null;const t=Math.round(s/60);if(t>=60){const o=Math.floor(t/60),n=t%60;return n>0?`${o}h ${n}min`:`${o}h`}return`${t} min`}async function Ue(s,t,o,n){try{const i=await ut(s,t,o,n);return i?{...i,source:"mapquest"}:{distanceMeters:null,distanceText:null,durationSeconds:null,durationText:null,source:"none"}}catch(i){return console.warn("MapQuest routing failed:",(i==null?void 0:i.message)||i),{distanceMeters:null,distanceText:null,durationSeconds:null,durationText:null,source:"none",error:(i==null?void 0:i.message)||String(i)}}}class ft{constructor(){this.isAppVisible=!0,this.listeners=new Set,this.lastActivity=Date.now(),this.activityTimeout=null,this.gpsConfig={foreground:{enableHighAccuracy:!0,maximumAge:1e3,timeout:5e3,updateInterval:1e3},background:{enableHighAccuracy:!1,maximumAge:1e4,timeout:3e4,updateInterval:3e4},inactive:{enableHighAccuracy:!1,maximumAge:6e4,timeout:6e4,updateInterval:12e4}},this.currentMode="foreground",this.init()}init(){document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),window.addEventListener("focus",this.handleFocus.bind(this)),window.addEventListener("blur",this.handleBlur.bind(this)),this.trackUserActivity(),console.log("🔋 [Battery] Service inicijalizovan")}handleVisibilityChange(){this.isAppVisible=!document.hidden,this.updateMode(),console.log("🔋 [Battery] Visibility changed:",this.isAppVisible?"visible":"hidden")}handleFocus(){this.isAppVisible=!0,this.updateActivity(),this.updateMode(),console.log("🔋 [Battery] App focused")}handleBlur(){this.isAppVisible=!1,this.updateMode(),console.log("🔋 [Battery] App blurred")}trackUserActivity(){const t=["mousedown","mousemove","keypress","scroll","touchstart","click"],o=()=>{this.updateActivity()};t.forEach(n=>{document.addEventListener(n,o,{passive:!0})})}updateActivity(){this.lastActivity=Date.now(),this.activityTimeout&&clearTimeout(this.activityTimeout),this.activityTimeout=setTimeout(()=>{this.updateMode()},5*60*1e3),this.updateMode()}updateMode(){const n=Date.now()-this.lastActivity>5*60*1e3;let i;if(this.isAppVisible?n?i="inactive":i="foreground":i="background",i!==this.currentMode){const l=this.currentMode;this.currentMode=i,console.log(`🔋 [Battery] Mode changed: ${l} → ${i}`),this.notifyListeners({type:"mode_changed",oldMode:l,newMode:i,config:this.getCurrentConfig()})}}getCurrentConfig(){return this.gpsConfig[this.currentMode]}getCurrentMode(){return this.currentMode}addListener(t){return this.listeners.add(t),()=>this.listeners.delete(t)}removeListener(t){this.listeners.delete(t)}notifyListeners(t){this.listeners.forEach(o=>{try{o(t)}catch(n){console.error("🔋 [Battery] Error in listener:",n)}})}async getBatteryInfo(){if("getBattery"in navigator)try{const t=await navigator.getBattery();return{level:Math.round(t.level*100),charging:t.charging,chargingTime:t.chargingTime,dischargingTime:t.dischargingTime}}catch(t){console.warn("🔋 [Battery] Battery API not available:",t)}return null}async getAdaptiveGpsConfig(){const t=await this.getBatteryInfo(),o=this.getCurrentConfig();return t&&t.level<20&&!t.charging?{...o,enableHighAccuracy:!1,maximumAge:6e4,updateInterval:Math.max(o.updateInterval*2,6e4)}:t&&t.level<50&&!t.charging?{...o,maximumAge:Math.max(o.maximumAge*1.5,5e3),updateInterval:Math.max(o.updateInterval*1.5,5e3)}:o}destroy(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("focus",this.handleFocus),window.removeEventListener("blur",this.handleBlur),this.activityTimeout&&clearTimeout(this.activityTimeout),this.listeners.clear(),console.log("🔋 [Battery] Service destroyed")}}const se=new ft;function vt(){const[s,t]=h.useState(se.getCurrentMode()),[o,n]=h.useState(se.getCurrentConfig()),[i,l]=h.useState(null);return h.useEffect(()=>{const m=a=>{a.type==="mode_changed"&&(t(a.newMode),n(a.config))},v=se.addListener(m);return se.getBatteryInfo().then(l),v},[]),{mode:s,config:o,batteryInfo:i,getAdaptiveConfig:async()=>await se.getAdaptiveGpsConfig(),isBackground:s==="background",isInactive:s==="inactive",isForeground:s==="foreground"}}function bt(s,t,o,n){const l=(o-s)*Math.PI/180,u=(n-t)*Math.PI/180,m=Math.sin(l/2)*Math.sin(l/2)+Math.cos(s*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 6371*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}class wt{constructor(){this.debounceDelay=2e3,this.minDistanceThreshold=.05,this.speedAdaptiveThresholds={walking:{speed:5,distance:.02,delay:1500},cycling:{speed:20,distance:.05,delay:2e3},driving:{speed:50,distance:.1,delay:3e3},highway:{speed:80,distance:.2,delay:4e3}},this.cache=new Map,this.maxCacheSize=100,this.cacheExpirationTime=10*60*1e3,this.lastPosition=null,this.lastGeocodingTime=0,this.pendingTimeout=null,this.currentSpeed=0,this.listeners=new Set,console.log("🌍 [ReverseGeo] Service inicijalizovan")}async reverseGeocode(t,o,n=0,i=!1){this.currentSpeed=n;const l=Date.now(),u={lat:t,lon:o},m=this.generateCacheKey(t,o);if(!i){const a=this.getCached(m);if(a)return console.log("🌍 [ReverseGeo] Served from cache:",m),this.notifyListeners({type:"result",data:a.data,source:"cache",position:u}),a.data}const v=this.getSpeedBasedThresholds(n);if(!i&&this.lastPosition){const a=bt(this.lastPosition.lat,this.lastPosition.lon,t,o);if(a<v.distance)return console.log(`🌍 [ReverseGeo] Skipped - insufficient movement: ${(a*1e3).toFixed(0)}m < ${(v.distance*1e3).toFixed(0)}m`),null}return!i&&l-this.lastGeocodingTime<v.delay?(console.log(`🌍 [ReverseGeo] Skipped - too soon: ${l-this.lastGeocodingTime}ms < ${v.delay}ms`),this.scheduleDelayedGeocoding(t,o,n,v.delay),null):(this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=null),await this.performGeocoding(t,o,u,m))}scheduleDelayedGeocoding(t,o,n,i){this.pendingTimeout&&clearTimeout(this.pendingTimeout),this.pendingTimeout=setTimeout(async()=>{console.log("🌍 [ReverseGeo] Executing delayed geocoding"),await this.reverseGeocode(t,o,n,!0),this.pendingTimeout=null},i)}async performGeocoding(t,o,n,i){try{this.notifyListeners({type:"started",position:n});const l=await this.callReverseGeocodingAPI(t,o);return l&&(l.address||l.city)?(this.setCached(i,l),this.lastPosition=n,this.lastGeocodingTime=Date.now(),console.log(`🌍 [ReverseGeo] Success for ${t.toFixed(4)}, ${o.toFixed(4)}:`,l),this.notifyListeners({type:"result",data:l,source:"api",position:n}),l):(console.warn("🌍 [ReverseGeo] No valid result received"),null)}catch(l){return console.error("🌍 [ReverseGeo] Error:",l),this.notifyListeners({type:"error",error:l.message,position:n}),null}finally{this.notifyListeners({type:"finished",position:n})}}getSpeedBasedThresholds(t){const o=(t||0)*3.6;return o<this.speedAdaptiveThresholds.walking.speed?this.speedAdaptiveThresholds.walking:o<this.speedAdaptiveThresholds.cycling.speed?this.speedAdaptiveThresholds.cycling:o<this.speedAdaptiveThresholds.driving.speed?this.speedAdaptiveThresholds.driving:this.speedAdaptiveThresholds.highway}generateCacheKey(t,o){return`${t.toFixed(3)},${o.toFixed(3)}`}getCached(t){const o=this.cache.get(t);if(o){const n=Date.now();if(n-o.timestamp<this.cacheExpirationTime)return o.lastAccessed=n,o;this.cache.delete(t)}return null}setCached(t,o){const n=Date.now();this.cache.size>=this.maxCacheSize&&this.cleanupCache(),this.cache.set(t,{data:o,timestamp:n,lastAccessed:n})}cleanupCache(){const t=Array.from(this.cache.entries());t.sort((n,i)=>n[1].lastAccessed-i[1].lastAccessed);const o=Math.floor(t.length*.25);for(let n=0;n<o;n++)this.cache.delete(t[n][0]);console.log(`🌍 [ReverseGeo] Cache cleanup: removed ${o} entries`)}async callReverseGeocodingAPI(t,o){var n,i,l,u,m,v,a,p,b,g,E;try{const j=Math.round(o*1e6),z=Math.round(t*1e6),H="/vor-proxy",C={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:j,y:z,acc:20}},formatted:!1,ext:"VAO.22",svcReqL:[]},T={...C,svcReqL:[{meth:"LocGeoPos",req:{ring:{cCrd:{x:j,y:z},minDist:0,maxDist:30},locL:[{type:"S",mode:["foot","bike","car"]},{type:"P"},{type:"A"}],maxLoc:1,getPOIs:!1,getStops:!1}}]},w=await fetch(H,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)});if(w.ok){const _=await w.json();if((u=(l=(i=(n=_==null?void 0:_.svcResL)==null?void 0:n[0])==null?void 0:i.res)==null?void 0:l.locL)!=null&&u[0]){const $=_.svcResL[0].res.locL[0];if($.name){const S=$.name.split(","),G=((m=S[0])==null?void 0:m.trim())||"";let I="";return S.length>1&&(I=S.slice(1).join(",").trim()),{address:G,city:I}}}}const c={...C,svcReqL:[{meth:"LocMatch",req:{input:{loc:{name:"",crd:{x:j,y:z},type:"C"},field:"S"}}}]},L=await fetch(H,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(L.ok){const _=await L.json();if((g=(b=(p=(a=(v=_==null?void 0:_.svcResL)==null?void 0:v[0])==null?void 0:a.res)==null?void 0:p.match)==null?void 0:b.locL)!=null&&g[0]){const $=_.svcResL[0].res.match.locL[0];if($.name){const S=$.name.split(","),G=((E=S[0])==null?void 0:E.trim())||"";let I="";return S.length>1&&(I=S.slice(1).join(",").trim()),{address:G,city:I}}}}return{address:"",city:""}}catch(j){throw console.error("🌍 [ReverseGeo] API Error:",j),j}}addListener(t){return this.listeners.add(t),()=>this.listeners.delete(t)}removeListener(t){this.listeners.delete(t)}notifyListeners(t){this.listeners.forEach(o=>{try{o(t)}catch(n){console.error("🌍 [ReverseGeo] Listener error:",n)}})}getStats(){return{cacheSize:this.cache.size,maxCacheSize:this.maxCacheSize,lastPosition:this.lastPosition,lastGeocodingTime:this.lastGeocodingTime,currentSpeed:this.currentSpeed,currentThresholds:this.getSpeedBasedThresholds(this.currentSpeed),isPending:!!this.pendingTimeout}}clearCache(){this.cache.clear(),console.log("🌍 [ReverseGeo] Cache cleared")}setThresholds(t){Object.assign(this.speedAdaptiveThresholds,t),console.log("🌍 [ReverseGeo] Custom thresholds applied:",t)}destroy(){this.pendingTimeout&&clearTimeout(this.pendingTimeout),this.cache.clear(),this.listeners.clear(),console.log("🌍 [ReverseGeo] Service destroyed")}}const Q=new wt;function yt(){const[s,t]=h.useState(!1),[o,n]=h.useState(null),[i,l]=h.useState(null),[u,m]=h.useState(null);h.useEffect(()=>{const b=E=>{switch(E.type){case"started":t(!0),l(null);break;case"result":n(E.data),t(!1);break;case"error":l(E.error),t(!1);break;case"finished":t(!1);break}},g=Q.addListener(b);return m(Q.getStats()),g},[]);const v=async(b,g,E,j=!1)=>await Q.reverseGeocode(b,g,E,j),a=()=>{m(Q.getStats())};return{isLoading:s,lastResult:o,error:i,stats:u,reverseGeocode:v,refreshStats:a,clearCache:()=>{Q.clearCache(),a()},service:Q}}const jt=({children:s,className:t="",style:o,title:n="Mapa dostave - Austrija",loading:i=!1,address:l="",city:u="",onNavigate:m,onSearchSelect:v,mapRef:a,onLocateMe:p,autoLocate:b=!0,selectedMarker:g=null,footerRef:E,isMobile:j=typeof window<"u"?window.innerWidth<768:!1,sidebarLayout:z=!1,headerHeight:H=80,onMapClickCloseSidebar:C,alwaysShowSearchInterface:T=!1,hideSearchAndInfo:w=!1})=>{const[c,L]=h.useState(null),[_,$]=h.useState(""),[S,G]=h.useState(""),[I,J]=h.useState([]),[f,ce]=h.useState(null),[N,de]=h.useState(!1),[U,K]=h.useState(!1),[ae,we]=h.useState(!1),[q,ye]=h.useState(null),[qe,je]=h.useState(!1),[ue,Mt]=h.useState(null),[F,Ne]=h.useState(0),[Ae,_e]=h.useState(0),[ne,Ee]=h.useState(!1),[he,Ye]=h.useState({top:0,left:0,width:0}),{mode:me,getAdaptiveConfig:We}=vt(),{reverseGeocode:Ze,service:Se}=yt(),O=h.useRef(null),ge=h.useRef(null),D=h.useRef(null);h.useRef(!1);const xe=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints>0),Pe=typeof window<"u"&&window.innerWidth>=1024,pe=()=>{if(O.current&&j){const r=O.current.getBoundingClientRect();Ye({top:r.bottom+window.scrollY+8,left:r.left+window.scrollX,width:r.width})}},Qe=(r,x,d,y)=>{const R=(d-r)*Math.PI/180,B=(y-x)*Math.PI/180,V=Math.sin(R/2)*Math.sin(R/2)+Math.cos(r*Math.PI/180)*Math.cos(d*Math.PI/180)*Math.sin(B/2)*Math.sin(B/2);return 6371*(2*Math.atan2(Math.sqrt(V),Math.sqrt(1-V)))},Je=(r,x=50)=>{if(!r||r<=0)return null;const d=r/1e3/x;return Math.round(d*3600)},Te=()=>{var r;(r=a==null?void 0:a.current)!=null&&r.zoomIn&&a.current.zoomIn()},Ce=()=>{var r;(r=a==null?void 0:a.current)!=null&&r.zoomOut&&a.current.zoomOut()},Me=()=>{if(console.log("📍 Lociraj me kliknuto - tražim GPS lokaciju"),!navigator.geolocation){alert("Geolokacija nije podržana u ovom pregledniku.");return}navigator.geolocation.getCurrentPosition(r=>{var d;console.log("📍 GPS lokacija pronađena:",r.coords);const x=[r.coords.latitude,r.coords.longitude];L({lat:r.coords.latitude,lon:r.coords.longitude});try{(d=a==null?void 0:a.current)!=null&&d.setView&&a.current.setView(x,17)}catch(y){console.warn("Map setView not available",y)}p&&p(x)},r=>{console.error("📍 GPS greška:",r),alert("Nije moguće dobiti lokaciju. Provjerite dozvole preglednika.")},{enableHighAccuracy:!0,maximumAge:5e3,timeout:15e3})},Le=()=>{if(N)document.exitFullscreen&&document.exitFullscreen().then(()=>{de(!1)});else{const r=ge.current;r!=null&&r.requestFullscreen&&r.requestFullscreen().then(()=>{de(!0),xe&&setTimeout(()=>{var x;(x=a==null?void 0:a.current)!=null&&x.setView&&c&&a.current.setView([c.lat,c.lon],17)},100)})}};h.useEffect(()=>((async()=>{if(navigator.geolocation){D.current&&(navigator.geolocation.clearWatch(D.current),D.current=null);try{const x=await We();console.log(`🔋 [GPS] Starting tracking in ${me} mode:`,x);const d=navigator.geolocation.watchPosition(y=>{var R,B;const P={lat:y.coords.latitude,lon:y.coords.longitude};if(L(P),Ne(y.coords.speed||0),_e(y.coords.heading||0),N&&((R=a==null?void 0:a.current)!=null&&R.setView)){const V=(B=a==null?void 0:a.current)!=null&&B.getZoom?a.current.getZoom():void 0;a.current.setView([P.lat,P.lon],V)}},y=>{console.error(`🔋 [GPS] Tracking error in ${me} mode:`,y)},x);D.current=d}catch(x){console.error("🔋 [GPS] Failed to start adaptive tracking:",x);const d=navigator.geolocation.watchPosition(y=>{var R,B;const P={lat:y.coords.latitude,lon:y.coords.longitude};if(L(P),Ne(y.coords.speed||0),_e(y.coords.heading||0),N&&((R=a==null?void 0:a.current)!=null&&R.setView)){const V=(B=a==null?void 0:a.current)!=null&&B.getZoom?a.current.getZoom():void 0;a.current.setView([P.lat,P.lon],V)}},y=>console.error("GPS tracking error:",y),{enableHighAccuracy:!0,maximumAge:1e3,timeout:5e3});D.current=d}}})(),()=>{var x;D.current&&((x=navigator.geolocation)!=null&&x.clearWatch)&&(navigator.geolocation.clearWatch(D.current),D.current=null)}),[me,N]),h.useEffect(()=>{const r=()=>{de(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",r),()=>document.removeEventListener("fullscreenchange",r)},[]),h.useEffect(()=>{c&&c.lat&&c.lon&&(console.log("📍 Coordinates changed, starting debounced reverse geocoding:",c),Ze(c.lat,c.lon,F))},[c,F]),h.useEffect(()=>{const r=d=>{if(d.type==="result"&&d.data){const y=`${d.data.address}${d.data.city?", "+d.data.city:""}`;$(y),console.log("📍 Address updated from debounced service:",y)}};return Se.addListener(r)},[Se]),h.useEffect(()=>{let r=!1;(async()=>{if(!(!c||!f||!f.lat||!f.lon))try{je(!0),console.log("🗺️ Computing route from",c,"to",f);const d=await Ue(c.lat,c.lon,f.lat,f.lon);if(r)return;ye(d||null)}catch(d){console.warn("🗺️ Route computation failed:",(d==null?void 0:d.message)||d),r||ye(null)}finally{r||je(!1)}})();try{window.__triggerRoute=async()=>{if(!c||!f){console.warn("window.__triggerRoute: missing currentCoords or selectedLocation",{currentCoords:c,selectedLocation:f});return}console.log("window.__triggerRoute: invoking getDrivingRouteInfo",{currentCoords:c,selectedLocation:f});try{const d=await Ue(c.lat,c.lon,f.lat,f.lon);return console.log("window.__triggerRoute result",d),d}catch(d){throw console.error("window.__triggerRoute error",d),d}}}catch{}return()=>{r=!0}},[c,f]),h.useEffect(()=>{b&&!c&&navigator.geolocation&&(console.log("🚀 Auto-locating on component mount"),navigator.geolocation.getCurrentPosition(r=>{var x;console.log("📍 Auto-locate GPS found:",r.coords),L({lat:r.coords.latitude,lon:r.coords.longitude});try{(x=a==null?void 0:a.current)!=null&&x.setView&&a.current.setView([r.coords.latitude,r.coords.longitude],15)}catch(d){console.warn("Map setView not available",d)}},r=>{console.warn("📍 Auto-locate failed:",r)},{enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}))},[b,c,a]),h.useEffect(()=>{if(console.log("📍 Props changed - address:",l,"city:",u,"selectedMarker:",g),l||u||g){console.log("📍 Setting location from props:",{address:l,city:u,selectedMarker:g});let r=null,x=null;g&&(g.lat!==void 0&&g.lon!==void 0?(r=g.lat,x=g.lon):g.lat!==void 0&&g.lng!==void 0&&(r=g.lat,x=g.lng));const d={address:l||"",city:u||"",lat:r,lon:x};if(d.address||d.city||d.lat&&d.lon){ce(d),console.log("🎯 Selected location set from external props:",d);const y=(l||"")+(u?`, ${u}`:"");y.trim()&&G(y.trim())}}else console.log("📍 Clearing selected location - no data"),ce(null),G("")},[l,u,g]),h.useEffect(()=>{const r=()=>{U&&j&&pe()};return window.addEventListener("scroll",r),window.addEventListener("resize",r),()=>{window.removeEventListener("scroll",r),window.removeEventListener("resize",r)}},[U,j]);const Xe=async r=>{if(!r||r.length<3){J([]);return}we(!0);try{const x=await dt(r);J(x||[])}catch(x){console.error("Greška pri pretraživanju:",x),J([])}finally{we(!1)}},fe=r=>{const x=r.target.value;if(G(x),ne){Ee(!1);return}x.length>=3?Xe(x):J([])},ke=r=>{var y,P,R,B;console.log("🎯 Suggestion clicked:",r);const x=(y=r.crd)==null?void 0:y.x,d=(P=r.crd)==null?void 0:P.y;if(typeof x=="number"&&typeof d=="number"&&((R=a==null?void 0:a.current)!=null&&R.setView)){const V=d/1e6,ve=x/1e6;a.current.setView([V,ve],17);let Y=((B=r.nameFormatted)==null?void 0:B.text)||r.name||"",X=Y,ee="";const Be=/<br\s*\/?.*?>/i;if(Be.test(Y)){const te=Y.split(Be);X=te[0].trim(),ee=te.slice(1).join(" ").trim()}else if(Y.includes(",")){const te=Y.split(",");X=te[0].trim(),ee=te.slice(1).join(",").trim()}const ze=X+(ee?`, ${ee}`:"");G(ze);const be={address:X,city:ee,lat:V,lon:ve,data:{nameFormatted:{text:Y},name:X},label:ze};ce(be),console.log("🎯 Selected location set:",be),v&&v(be),J([]),Ee(!0),K(!1),O.current&&O.current.blur()}},Ie=()=>{S.trim()&&m&&m(S.trim())},Re=N?{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:9999}:{};return e.jsxs("div",{className:`relative ${t} ${N?"fixed inset-0 z-[9999]":""}`,style:o,children:[Pe&&!N?e.jsxs("div",{className:"flex h-screen bg-gradient-to-br from-slate-100 via-white to-blue-50",children:[e.jsx("div",{className:"w-1/2 bg-gradient-to-b from-white via-slate-50 to-blue-50 border-r border-slate-200/50 flex flex-col backdrop-blur-sm",children:e.jsxs("div",{className:"p-6 flex flex-col gap-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Navigacija"}),e.jsx("p",{className:"text-slate-600",children:"Pronađi rutu do odredišta"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{ref:O,type:"text",value:S,onChange:fe,onFocus:()=>K(!0),onBlur:()=>{setTimeout(()=>{ne||K(!1)},200)},className:"w-full px-4 py-3 rounded-2xl border border-slate-300 bg-white/80 backdrop-blur-sm shadow-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-200 placeholder-slate-500",placeholder:"Unesi adresu za navigaciju...",autoComplete:"off"}),U&&(I.length>0||ae)&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white/95 backdrop-blur-sm border border-slate-200 rounded-2xl shadow-2xl max-h-60 overflow-y-auto z-[3000]",children:ae?e.jsxs("div",{className:"p-4 flex items-center gap-3 text-slate-600",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),"Tražim adrese..."]}):I.length===0?e.jsxs("div",{className:"p-4 text-slate-600",children:['Nema rezultata za "',S,'"']}):I.map((r,x)=>{var d,y;return e.jsx("div",{className:"p-4 hover:bg-blue-50/50 cursor-pointer border-b border-slate-100 last:border-b-0 transition-colors duration-150",onClick:()=>ke(r),onMouseDown:P=>P.preventDefault(),children:e.jsx("div",{className:"font-medium text-slate-800",children:((y=(d=r.nameFormatted)==null?void 0:d.text)==null?void 0:y.replace(/<[^>]*>/g,""))||r.name||""})},x)})})]}),e.jsx("button",{className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-blue-500 to-blue-600 text-white hover:from-blue-600 hover:to-blue-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95",onClick:Ie,disabled:!S.trim(),title:"Otvori navigaciju",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"})})})]})})}),e.jsx("div",{className:"space-y-4 flex-1",children:f?e.jsx("div",{className:"p-4 rounded-2xl bg-gradient-to-br from-white/90 via-blue-50/30 to-purple-50/20 backdrop-blur-md border border-white/30 shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[_?e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-xl bg-gradient-to-r from-emerald-50/80 to-green-50/60 backdrop-blur-sm border border-emerald-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-emerald-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("span",{className:"text-sm font-medium text-slate-800 truncate",title:_,children:_})]}):c&&typeof c.lat=="number"&&typeof c.lon=="number"?e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-xl bg-gradient-to-r from-emerald-50/80 to-green-50/60 backdrop-blur-sm border border-emerald-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-emerald-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsxs("span",{className:"text-sm font-medium text-slate-800 truncate",title:`${c.lat.toFixed(6)}, ${c.lon.toFixed(6)}`,children:[c.lat.toFixed(6),", ",c.lon.toFixed(6)]})]}):e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-xl bg-gradient-to-r from-gray-50/80 to-slate-50/60 backdrop-blur-sm border border-gray-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("span",{className:"text-sm font-medium text-slate-600 truncate",children:"Moja lokacija nije dostupna"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-xl bg-gradient-to-r from-rose-50/80 to-red-50/60 backdrop-blur-sm border border-rose-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-rose-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("circle",{cx:"12",cy:"12",r:"6"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),e.jsx("span",{className:"text-sm font-medium text-slate-800 truncate",title:`${f.address}${f.city?`, ${f.city}`:""}`,children:`${String(f.address)}${f.city?`, ${String(f.city)}`:""}`})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"text-right bg-gradient-to-br from-blue-50/50 to-indigo-50/30 backdrop-blur-sm border border-blue-200/30 rounded-xl px-4 py-3",children:e.jsxs("div",{className:"text-base font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:[ue&&typeof ue.compact=="string"?ue.compact:q?e.jsxs(e.Fragment,{children:[q.durationText||oe(q.durationSeconds)||"--"," • ",q.distanceText||re(q.distanceMeters)||"--"]}):c&&f?(()=>{const r=Qe(c.lat,c.lon,f.lat,f.lon),x=Math.round(r*1e3),d=Je(x,40);return d?`${oe(d)} • ${re(x)}`:"--"})():"--",qe&&e.jsx("span",{className:"ml-2",children:e.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin inline-block"})})]})})})]})}):e.jsxs(e.Fragment,{children:[reverseGeocodingLoading?e.jsx("div",{className:"p-4 rounded-2xl bg-white/80 backdrop-blur-sm border border-slate-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"📍"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-slate-600 font-medium",children:"Prepoznajem adresu..."})]})]})}):_?e.jsx("div",{className:"p-4 rounded-2xl bg-white/80 backdrop-blur-sm border border-slate-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"�"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-1",children:"Moja lokacija"}),e.jsx("p",{className:"text-sm text-slate-600",children:_})]})]})}):c&&typeof c.lat=="number"&&typeof c.lon=="number"?e.jsx("div",{className:"p-4 rounded-2xl bg-white/70 backdrop-blur-sm border border-slate-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"�"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-1",children:"Moja lokacija"}),e.jsxs("p",{className:"text-sm text-slate-600",children:[c.lat.toFixed(6),", ",c.lon.toFixed(6)]})]})]})}):e.jsx("div",{className:"p-4 rounded-2xl bg-white/60 backdrop-blur-sm border border-slate-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl opacity-60",children:"📍"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-slate-700 mb-1",children:"Moja lokacija"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Lokacija nije dostupna"})]})]})}),f&&!_&&e.jsx("div",{className:"p-4 rounded-2xl bg-white/80 backdrop-blur-sm border border-slate-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"🎯"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-1",children:"Odabrana adresa"}),e.jsx("p",{className:"text-sm text-gray-600",children:`${String(f.address)}${f.city?`, ${String(f.city)}`:""}`})]})]})}),S&&!f&&e.jsx("div",{className:"p-3 rounded-lg bg-white border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"🔍"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-1",children:"Pretraživanje"}),e.jsx("p",{className:"text-sm text-gray-600",children:S})]})]})})]})})]})}),e.jsx("div",{className:"w-1/2 relative",children:e.jsx("div",{ref:ge,className:"w-full h-full bg-gradient-to-br from-gray-100 via-gray-200 to-gray-300 overflow-hidden",style:Re,children:i?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm z-20",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-6"}),e.jsx("p",{className:"text-slate-700 font-medium text-lg",children:"Učitavam mapu..."})]}):e.jsxs(e.Fragment,{children:[Z.Children.map(s,r=>{if(Z.isValidElement(r)){const x=c?[c.lat,c.lon]:r.props.userLocation||null;return Z.cloneElement(r,{routeInfo:q||r.props.routeInfo||null,userLocation:x,selectedMarker:f||r.props.selectedMarker||null,speed:F||r.props.speed||0,heading:Ae||r.props.heading||0,isFullscreen:N||r.props.isFullscreen||!1})}return r}),e.jsxs("div",{className:"absolute right-6 top-20 flex flex-col gap-3 z-30",children:[e.jsx("button",{className:"w-12 h-12 bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-blue-600 hover:bg-white group",onClick:Te,title:"Povećaj zoom",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z"})})}),e.jsx("button",{className:"w-12 h-12 bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-blue-600 hover:bg-white group",onClick:Ce,title:"Smanji zoom",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M19 11H5v2h14z"})})}),e.jsx("button",{className:"w-12 h-12 bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-emerald-600 hover:bg-white group",onClick:Me,title:"Lociraj me",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z"})})}),xe&&e.jsx("button",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 text-white border border-purple-400/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center hover:from-purple-600 hover:to-purple-700 group",onClick:Le,title:N?"Izađi iz punog ekrana":"Puni ekran",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:N?e.jsx("path",{d:"M18 7h-3V4h-2v3H10V4H8v3H5v2h3v3H5v2h3v3h2v-3h3v3h2v-3h3v-2h-3V9h3V7z"}):e.jsx("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})})})]}),e.jsx("div",{className:"absolute right-6 bottom-6 bg-white/95 backdrop-blur-sm border border-slate-300 rounded-2xl px-4 py-3 shadow-xl z-1000",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse bg-blue-500"}),e.jsx("span",{className:"font-bold text-lg text-slate-800",children:F?(F*3.6).toFixed(1):"0"}),e.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"km/h"})]})})]})})})]}):e.jsxs("div",{className:`relative ${N?"fixed inset-0":"min-h-[300px] h-full"} ${w&&j?"bg-white":"bg-gradient-to-br from-slate-100 via-white to-blue-50 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20"} overflow-hidden`,children:[(!w||!j)&&e.jsxs("div",{className:"relative bg-gradient-to-r from-blue-600 via-purple-600 to-blue-700 text-white p-6 backdrop-blur-sm",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsxs("div",{className:"relative z-10",children:[n&&e.jsx("h3",{className:"text-2xl font-bold mb-2 text-center",children:n}),!w&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{ref:O,type:"text",value:S,onChange:fe,onFocus:()=>{K(!0),pe()},onBlur:()=>{setTimeout(()=>{ne||K(!1)},200)},className:"w-full px-4 py-3 rounded-2xl border border-white/30 bg-white/90 backdrop-blur-sm shadow-lg focus:ring-2 focus:ring-white focus:border-white outline-none transition-all duration-200 text-slate-800 placeholder-slate-500",placeholder:"Unesi adresu za navigaciju...",autoComplete:"off"})}),e.jsx("button",{className:"px-6 py-3 rounded-2xl bg-white/20 backdrop-blur-sm border border-white/30 text-white hover:bg-white/30 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",onClick:Ie,disabled:!S.trim(),title:"Otvori navigaciju",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"})})})]})]})]}),e.jsxs("div",{ref:ge,className:"flex-1 relative min-h-[500px] h-full bg-gradient-to-br from-gray-100 via-gray-200 to-gray-300 w-full box-border overflow-hidden",style:Re,children:[i?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm z-20",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-6"}),e.jsx("p",{className:"text-slate-700 font-medium text-lg",children:"Učitavam mapu..."})]}):e.jsxs(e.Fragment,{children:[Z.Children.map(s,r=>{if(Z.isValidElement(r)){const x=c?[c.lat,c.lon]:r.props.userLocation||null;return Z.cloneElement(r,{routeInfo:q||r.props.routeInfo||null,userLocation:x,selectedMarker:f||r.props.selectedMarker||null,speed:F||r.props.speed||0,heading:Ae||r.props.heading||0,isFullscreen:N||r.props.isFullscreen||!1})}return r}),N&&_&&(()=>{const x=(d=>d?d.split(",")[0].trim().replace(/^(Adresa:|Address:|Lokacija:|Location:)/i,"").trim()||d:"")(_);return e.jsx("div",{className:"absolute left-0 right-0 top-4 z-40",children:e.jsx("div",{className:"mx-4 bg-white/95 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{className:"text-lg",children:"📍"}),e.jsx("p",{className:"text-base font-bold text-slate-800 truncate",children:x})]})})})})(),w&&j&&e.jsx("div",{className:"absolute left-6 top-20 flex flex-col gap-3 z-30",children:e.jsx("button",{className:"w-12 h-12 bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-blue-600 hover:bg-white group",onClick:()=>{K(!U),U||(pe(),setTimeout(()=>{O.current&&O.current.focus()},100))},title:"Pretraži lokaciju",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",className:"group-hover:scale-110 transition-transform",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"M21 21l-4.35-4.35"})]})})}),w&&j&&U&&e.jsx("div",{className:"absolute left-20 top-6 right-6 z-40",children:e.jsx("div",{className:"h-12 bg-white/95 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl overflow-hidden",children:e.jsx("input",{ref:O,type:"text",value:S,onChange:fe,onBlur:()=>{setTimeout(()=>{ne||K(!1)},200)},className:"w-full h-full px-4 text-sm border-0 bg-transparent focus:ring-0 focus:outline-none text-slate-800 placeholder-slate-500",placeholder:"Unesi adresu za navigaciju...",autoComplete:"off"})})}),e.jsxs("div",{className:"absolute right-6 top-20 flex flex-col gap-3 z-30",children:[e.jsx("button",{className:`${N?"w-14 h-14":"w-12 h-12"} bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-blue-600 hover:bg-white group`,onClick:Te,title:"Povećaj zoom",children:e.jsx("svg",{width:N?"26":"22",height:N?"26":"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z"})})}),e.jsx("button",{className:`${N?"w-14 h-14":"w-12 h-12"} bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-blue-600 hover:bg-white group`,onClick:Ce,title:"Smanji zoom",children:e.jsx("svg",{width:N?"26":"22",height:N?"26":"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M19 11H5v2h14z"})})}),e.jsx("button",{className:`${N?"w-14 h-14":"w-12 h-12"} bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-emerald-600 hover:bg-white group`,onClick:Me,title:"Lociraj me",children:e.jsx("svg",{width:N?"26":"22",height:N?"26":"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z"})})}),xe&&e.jsx("button",{className:`${N?"w-14 h-14":"w-12 h-12"} bg-gradient-to-br from-purple-500 to-purple-600 text-white border border-purple-400/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center hover:from-purple-600 hover:to-purple-700 group`,onClick:Le,title:N?"Izađi iz punog ekrana":"Puni ekran",children:e.jsx("svg",{width:N?"24":"20",height:N?"24":"20",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:N?e.jsx("path",{d:"M18 7h-3V4h-2v3H10V4H8v3H5v2h3v3H5v2h3v3h2v-3h3v3h2v-3h3v-2h-3V9h3V7z"}):e.jsx("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})})})]}),e.jsx("div",{className:"absolute right-6 bottom-6 bg-white/95 backdrop-blur-sm border border-slate-300 rounded-2xl px-4 py-3 shadow-xl z-1000",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse bg-blue-500"}),e.jsx("span",{className:"font-bold text-lg text-slate-800",children:F?(F*3.6).toFixed(1):"0"}),e.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"km/h"})]})})]}),!Pe&&!w&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-white/95 via-white/90 to-transparent backdrop-blur-sm border-t border-white/20 p-4 space-y-2",children:[c?e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-gradient-to-r from-blue-50/80 to-indigo-50/60 backdrop-blur-sm border border-blue-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-blue-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsxs("span",{className:"text-xs font-medium text-slate-800 truncate",children:["Moja lokacija: ",c.lat.toFixed(4),", ",c.lon.toFixed(4)]})]}):e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-gradient-to-r from-gray-50/80 to-slate-50/60 backdrop-blur-sm border border-gray-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("span",{className:"text-xs font-medium text-slate-600 truncate",children:"Moja lokacija nije dostupna"})]}),f&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-gradient-to-r from-rose-50/80 to-red-50/60 backdrop-blur-sm border border-rose-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-rose-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("circle",{cx:"12",cy:"12",r:"6"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),e.jsx("span",{className:"text-xs font-medium text-slate-800 truncate",title:`${f.address}${f.city?`, ${f.city}`:""}`,children:`${f.address}${f.city?`, ${f.city}`:""}`})]}),S&&!f&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-gradient-to-r from-amber-50/80 to-yellow-50/60 backdrop-blur-sm border border-amber-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-amber-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"M21 21l-4.35-4.35"})]}),e.jsxs("span",{className:"text-xs font-medium text-slate-800 truncate",children:["Pretraživanje: ",S]})]})]})]}),z&&e.jsx("div",{className:"w-80 bg-gradient-to-b from-white via-slate-50 to-blue-50 border-l border-slate-200/50 flex flex-col backdrop-blur-sm",children:e.jsxs("div",{ref:E,className:"p-6 flex flex-col gap-4 h-full",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Informacije"]}),e.jsx("div",{className:"flex flex-col gap-4 flex-1"})]})})]}),j&&(!w&&U||w&&U)&&(I.length>0||ae)&&tt.createPortal(e.jsx("div",{className:"fixed bg-white/95 backdrop-blur-sm border border-slate-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-[99999]",style:{top:w?"calc(1.5rem + 48px + 8px)":he.top,left:w?"5rem":he.left,right:w?"1.5rem":"auto",width:w?"auto":he.width},children:ae?e.jsxs("div",{className:"p-3 flex items-center gap-2 text-slate-600",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm",children:"Tražim adrese..."})]}):I.length===0?e.jsxs("div",{className:"p-3 text-slate-600 text-sm",children:['Nema rezultata za "',S,'"']}):I.map((r,x)=>{var d,y;return e.jsxs("div",{className:"p-3 hover:bg-blue-50/50 cursor-pointer border-b border-slate-100 last:border-b-0 transition-colors duration-150",onClick:()=>ke(r),onMouseDown:P=>P.preventDefault(),children:[e.jsx("div",{className:"font-medium text-slate-800 text-sm",children:((y=(d=r.nameFormatted)==null?void 0:d.text)==null?void 0:y.replace(/<[^>]*>/g,""))||r.name||""}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:r.district||r.region||r.country||""})]},x)})}),document.body)]})},Nt=()=>{const s=rt();return h.useEffect(()=>{setTimeout(()=>{s.invalidateSize()},200)},[s]),null};function At(s,t){const o=Math.round(t*1e6),n=Math.round(s*1e6);return{x:o,y:n}}const Fe=`${M.API_BASE_URL}/vor-proxy`,ie={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:14289513,y:46624058,acc:20}},formatted:!1,ext:"VAO.22",svcReqL:[]};function _t({onAddressSelect:s}){const[t,o]=h.useState(null),[n,i]=h.useState(""),[l,u]=h.useState(null);if(h.useRef(null),Oe({click:a=>{console.log("🗺️ Map clicked at:",a.latlng),o(a.latlng),i("Učitavanje adrese..."),u(null);const{x:p,y:b}=At(a.latlng.lat,a.latlng.lng);console.log("📍 Projected coordinates:",{x:p,y:b}),(async()=>{const g={...ie,client:{...ie.client,pos:{x:p,y:b,acc:20}},svcReqL:[{meth:"LocGeoPos",req:{ring:{cCrd:{x:p,y:b},minDist:0,maxDist:30},maxLoc:1,locFltrL:[{type:"PROD",mode:"INC",value:4087}],getPOIs:!0},id:"1|5|"}]};try{const j=await(await fetch(Fe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).json();if(j&&j.svcResL&&j.svcResL.length>0&&j.svcResL[0].res&&j.svcResL[0].res.locL&&j.svcResL[0].res.locL.length>0){const T=j.svcResL[0].res.locL[0];let w=T.nameFormatted&&T.nameFormatted.text||T.name||T.txt||"";/^-?\d+\.\d+, ?-?\d+\.\d+$/.test(w)&&(w="Nema adrese za ovu lokaciju"),i(w||"Adresa pronađena"),u({geoData:j,x:p,y:b});let c=w,L="";if(w&&w.includes(",")){const $=w.split(",");c=$[0].trim(),L=$.slice(1).join(",").trim()}const _={address:c,city:L,lat:a.latlng.lat,lon:a.latlng.lng};console.log("🎯 ClickToVORAddress calling onAddressSelect:",_),s&&s(_);return}const z={...ie,client:{...ie.client,pos:{x:p,y:b,acc:20}},svcReqL:[{meth:"LocMatch",req:{input:{field:"S",loc:{type:"C",crd:{x:p,y:b}},maxLoc:1,locFltrL:[{type:"META",value:"in_austria_test"}]}},id:"1|24|"}]},C=await(await fetch(Fe,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)})).json();if(u({matchData:C,x:p,y:b}),C&&C.svcResL&&C.svcResL.length>0&&C.svcResL[0].res&&C.svcResL[0].res.match&&C.svcResL[0].res.match.locL&&C.svcResL[0].res.match.locL.length>0){const T=C.svcResL[0].res.match.locL[0];let w=T.nameFormatted&&T.nameFormatted.text||T.name||T.txt||"";/^-?\d+\.\d+, ?-?\d+\.\d+$/.test(w)&&(w="Nema adrese za ovu lokaciju"),i(w||"Adresa pronađena");let c=w,L="";if(w&&w.includes(",")){const _=w.split(",");c=_[0].trim(),L=_.slice(1).join(",").trim()}s&&s({address:c,city:L,lat:a.latlng.lat,lon:a.latlng.lng});return}i("Adresa nije pronađena"),s&&s({address:"",city:"",lat:a.latlng.lat,lon:a.latlng.lng})}catch(E){i("Greška pri dohvaćanju adrese: "+((E==null?void 0:E.message)||JSON.stringify(E))),u(E),s&&s({address:"",city:"",lat:a.latlng.lat,lon:a.latlng.lng})}})()},move:()=>{o(null),i(""),v(!1)}}),n&&n.includes(",")){const a=n.split(",");a[0].trim(),a.slice(1).join(",").trim()}t==null||t.lat,t==null||t.lng;const[m,v]=h.useState(!0);return Oe({}),t?e.jsx(ot,{center:t,radius:7,pathOptions:{color:"#0ea5e9",fillColor:"#0ea5e9",fillOpacity:.92,weight:1.5}}):null}let Et=le.divIcon({html:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z" fill="#ef4444" stroke="#dc2626" stroke-width="2"/>
    <circle cx="12" cy="10" r="3" fill="white"/>
  </svg>`,className:"custom-div-icon",iconSize:[24,24],iconAnchor:[12,24]});le.Marker.prototype.options.icon=Et;function St({address:s,lat:t,lon:o,onClose:n,routeInfo:i,userLocation:l}){let u=s,m="";if(s&&s.includes(",")){const p=s.split(",");u=p[0].trim(),m=p.slice(1).join(",").trim()}const v=t&&o?`https://www.google.com/maps/search/?api=1&query=${t},${o}`:"#";let a=null;if(i&&i.distanceMeters&&i.durationSeconds){const p=i.durationText||oe(i.durationSeconds)||"--",b=i.distanceText||re(i.distanceMeters)||"--";a=`${p} • ${b}`}else if(i&&i.distance&&i.duration){const p=oe(i.duration)||"--",b=re(i.distance)||"--";a=`${p} • ${b}`}else if(l&&t&&o){const b=(t-l[0])*Math.PI/180,g=(o-l[1])*Math.PI/180,E=Math.sin(b/2)*Math.sin(b/2)+Math.cos(l[0]*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(g/2)*Math.sin(g/2),z=6371*(2*Math.atan2(Math.sqrt(E),Math.sqrt(1-E))),H=Math.round(z*1e3),T=H>0?Math.round(z/40*3600):null,w=T?oe(T):"--",c=re(H);a=`${w} • ${c}`}return e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl p-4 min-w-[240px] max-w-[320px] border border-gray-100 relative z-50",onMouseDown:p=>p.stopPropagation(),onClick:p=>p.stopPropagation(),children:[e.jsx("button",{onClick:p=>{p.preventDefault(),p.stopPropagation(),n()},onMouseDown:p=>{p.preventDefault(),p.stopPropagation()},className:"absolute -top-2 -right-2 w-8 h-8 flex items-center justify-center bg-gray-800 text-white hover:bg-gray-900 rounded-full shadow-lg transition-all duration-200 hover:scale-105 z-50","aria-label":"Zatvori popup",title:"Zatvori",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 leading-tight",children:u}),m&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:m})]})}),a&&e.jsx("div",{className:"flex items-center justify-center py-2 px-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-100",children:e.jsx("div",{className:"text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:a})}),e.jsx("button",{onClick:()=>window.open(v,"_blank"),className:"w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]",children:"Pokreni navigaciju"})]})]})}function Pt({position:s,address:t,speed:o=0,heading:n=0,isFullscreen:i=!1}){if(!s)return null;const l=()=>o>1?le.divIcon({html:`
          <div style="transform: rotate(${n}deg); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
            <div style="width: 32px; height: 32px; background: #3b82f6; border: 4px solid white; border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                <path d="M12 2l8 20-8-6-8 6 8-20z"/>
              </svg>
            </div>
          </div>
        `,className:"custom-location-marker",iconSize:[32,32],iconAnchor:[16,16]}):le.divIcon({html:`
          <div style="width: 16px; height: 16px; background: #3b82f6; border: 2px solid white; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.3); animation: pulse 2s infinite;">
          </div>
          <style>
            @keyframes pulse {
              0% { opacity: 1; }
              50% { opacity: 0.5; }
              100% { opacity: 1; }
            }
          </style>
        `,className:"custom-location-marker-static",iconSize:[16,16],iconAnchor:[8,8]});return e.jsx(De,{position:s,icon:l(),children:e.jsx(He,{children:typeof t<"u"&&t?String(t):"Moja lokacija"})})}function Tt({marker:s,onAddressSelect:t,routeInfo:o,userLocation:n}){var u,m,v;const i=h.useRef();if(h.useEffect(()=>{i.current&&s&&s.lat&&s.lon&&setTimeout(()=>{i.current.openPopup()},100)},[s==null?void 0:s.lat,s==null?void 0:s.lon]),!s||!s.lat||!s.lon)return null;const l=[s.lat,s.lon];return e.jsx(De,{position:l,ref:i,children:e.jsx(He,{autoPan:!0,autoClose:!1,closeOnClick:!1,children:e.jsx(St,{address:((m=(u=s.data)==null?void 0:u.nameFormatted)==null?void 0:m.text)||((v=s.data)==null?void 0:v.name)||s.label||`${String(s.address||"")}${s.city?`, ${String(s.city)}`:""}`,lat:s.lat,lon:s.lon,routeInfo:o,userLocation:n,onClose:()=>{t&&t(null)}})})})}function Ct({onAddressSelect:s,mapRef:t,selectedMarker:o,userLocation:n,routeInfo:i,currentAddress:l,speed:u,heading:m,isFullscreen:v}){const a=h.useRef(),p=t||a,b=h.useCallback(g=>{p&&(p.current=g)},[p]);return e.jsx("div",{className:"relative w-full h-full bg-gray-100",children:e.jsxs("div",{className:"w-full h-full",children:[e.jsxs(at,{center:[47.0707,15.4395],zoom:8,className:"w-full h-full z-0",ref:b,maxZoom:18,minZoom:6,zoomControl:!1,attributionControl:!1,children:[e.jsx(nt,{url:"https://maps.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png",attribution:'Datenquelle: <a href="https://www.basemap.at">basemap.at</a>',maxZoom:19}),e.jsx(Nt,{}),n&&e.jsx(Pt,{position:n,address:l,speed:u,heading:m,isFullscreen:v}),o&&e.jsx(Tt,{marker:o,onAddressSelect:s,routeInfo:i,userLocation:n}),e.jsx(_t,{onAddressSelect:s})]}),typeof u<"u"&&v&&e.jsx("div",{className:"absolute right-6 bottom-6 bg-white/95 backdrop-blur-sm border border-slate-300 rounded-2xl px-4 py-3 shadow-xl z-1000",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg text-slate-800",children:u?(u*3.6).toFixed(1):"0"}),e.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"km/h"})]})})]})})}const Rt=()=>{const s=st(),t=h.useRef(null),o=h.useRef(null),[n,i]=h.useState("night"),[l,u]=h.useState(null),[m,v]=h.useState({address:"",city:"",lat:null,lon:null}),a={night:{background:"from-slate-900 via-blue-900 to-indigo-900",accent:"from-blue-400 to-purple-400"}};h.useEffect(()=>{i("night")},[]);const p=n==="night",b=typeof window<"u"?window.innerWidth<768:!1;return h.useEffect(()=>{const g=()=>{t.current&&typeof t.current.invalidateSize=="function"&&(console.log("🗺️ Invalidating map size..."),t.current.invalidateSize())},E=setTimeout(g,500);return window.addEventListener("resize",g),()=>{clearTimeout(E),window.removeEventListener("resize",g)}},[]),h.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(g=>u([g.coords.latitude,g.coords.longitude]),g=>console.warn("Geolocation error:",g))},[]),e.jsxs("div",{className:`min-h-screen bg-gradient-to-br ${a[n].background} transition-all duration-1000`,children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx(W.div,{animate:{scale:[1,1.2,1],rotate:[0,90,0]},transition:{duration:20,repeat:1/0,ease:"linear"},className:`absolute top-20 left-10 w-96 h-96 bg-gradient-to-r ${a[n].accent} rounded-full mix-blend-multiply filter blur-3xl opacity-20`}),e.jsx(W.div,{animate:{scale:[1.2,1,1.2],rotate:[90,0,90]},transition:{duration:25,repeat:1/0,ease:"linear"},className:`absolute bottom-20 right-10 w-96 h-96 bg-gradient-to-r ${a[n].accent} rounded-full mix-blend-multiply filter blur-3xl opacity-20`})]}),e.jsx(W.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"relative z-10",children:e.jsx("div",{className:"flex items-center justify-between p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(W.button,{onClick:()=>s(-1),whileHover:{scale:1.05},whileTap:{scale:.95},className:`p-3 rounded-xl backdrop-blur-sm border transition-all duration-200 ${p?"bg-gray-800/90 border-gray-700 text-gray-100 hover:bg-gray-700/90":"bg-white/90 border-gray-200 text-gray-700 hover:bg-white/95"} shadow-lg hover:shadow-xl`,children:e.jsx($e,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-r ${a[n].accent} shadow-lg`,children:e.jsx(et,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold ${p?"text-white":"text-gray-900"}`,children:"Navigacija"}),e.jsx("p",{className:`text-sm ${p?"text-gray-400":"text-gray-600"}`,children:"Mapa dostave - Austrija"})]})]})]})})}),e.jsx(W.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:`relative z-10 ${b?"h-screen":"px-2 md:px-6 pb-2 md:pb-6"}`,children:e.jsx("div",{className:`${b?"h-full":`rounded-lg md:rounded-2xl backdrop-blur-sm border overflow-hidden shadow-2xl h-[calc(100vh-120px)] md:h-[calc(100vh-160px)] ${p?"bg-gray-800/90 border-gray-700":"bg-white/90 border-gray-200"}`}`,children:e.jsx(jt,{title:"Navigacija - Mapa dostave",mapRef:t,footerRef:o,className:"h-full w-full",style:{height:"100%",width:"100%"},address:(m==null?void 0:m.address)||"",city:(m==null?void 0:m.city)||"",selectedMarker:m,headerHeight:b?120:160,sidebarLayout:!b,hideSearchAndInfo:b,onNavigate:g=>{if(g&&typeof g=="object"&&typeof g.lat=="number"&&typeof g.lon=="number"){window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(`${g.lat},${g.lon}`)}&travelmode=driving`,"_blank");return}g&&window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(g)}`,"_blank")},onSearchSelect:g=>{console.log("🎯 Address selected:",g),v(g)},onLocateMe:u,children:e.jsx(Ct,{onAddressSelect:g=>{console.log("🗺️ MapView address select:",g),v(g)},mapRef:t,selectedMarker:m,userLocation:l,routeInfo:null})})})}),b&&e.jsx(W.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.2},onClick:()=>s(-1),className:"fixed top-4 left-4 z-50 p-3 rounded-2xl bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-xl hover:shadow-2xl hover:scale-105 active:scale-95 transition-all duration-200",children:e.jsx($e,{className:"w-6 h-6 text-gray-700"})})]})};export{Rt as default};

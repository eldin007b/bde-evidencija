import{j as e,i as V,aj as F,X as $,m as D,N as G}from"./chunk-v5-1765395142943-CtGZdOO1.js";import{r as h,u as K}from"./chunk-v5-1765395142943-DzTHeiPn.js";import{u as k,a as S,C as Y,M as q,T as H,b as B,P as z,L}from"./chunk-v5-1765395142943-DFYUCRfo.js";const Q=()=>{const t=k();return h.useEffect(()=>{setTimeout(()=>{t.invalidateSize()},200)},[t]),null},O={VITE_GITHUB_REPO:"eldin007b/gls-scraper",VITE_GITHUB_TOKEN:"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",VITE_MAPQUEST_API_KEY:"",VITE_MAPQUEST_PROXY_URL:"https://dsltpiupbfopyvuiqffg.supabase.co/functions/v1/mapquest-proxy",VITE_WORKFLOW_FILE:"scraper.yml"};var U={};const m=typeof import.meta<"u"&&O?O:{},y=typeof process<"u"&&U?U:{},W="https://dsltpiupbfopyvuiqffg.supabase.co/functions/v1",b={API_BASE_URL:m.VITE_API_BASE_URL||m.REACT_APP_API_BASE_URL||y.REACT_APP_API_BASE_URL||W};b.MAPQUEST_API_KEY=m.VITE_MAPQUEST_API_KEY||m.REACT_APP_MAPQUEST_API_KEY||y.REACT_APP_MAPQUEST_API_KEY||"";b.MAPQUEST_PROXY_URL=m.VITE_MAPQUEST_PROXY_URL||m.REACT_APP_MAPQUEST_PROXY_URL||y.REACT_APP_MAPQUEST_PROXY_URL||`${b.API_BASE_URL}/mapquest-proxy`;b.GITHUB_TOKEN=m.VITE_GITHUB_TOKEN||m.REACT_APP_GITHUB_TOKEN||y.REACT_APP_GITHUB_TOKEN||"";b.GITHUB_REPO=m.VITE_GITHUB_REPO||m.REACT_APP_GITHUB_REPO||y.REACT_APP_GITHUB_REPO||"eldin007b/gls-scraper";b.WORKFLOW_FILE=m.VITE_WORKFLOW_FILE||m.REACT_APP_WORKFLOW_FILE||y.REACT_APP_WORKFLOW_FILE||"scraper.yml";b.ROUTE_STRATEGY=m.VITE_ROUTE_STRATEGY||m.REACT_APP_ROUTE_STRATEGY||y.REACT_APP_ROUTE_STRATEGY||"";b.VORANACHB_URL=m.VITE_VORANACHB_URL||m.REACT_APP_VORANACHB_URL||y.REACT_APP_VORANACHB_URL||"";function X(t,s){const o=Math.round(s*1e6),i=Math.round(t*1e6);return{x:o,y:i}}const I=`${b.API_BASE_URL}/vor-proxy`,E={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:14289513,y:46624058,acc:20}},formatted:!1,ext:"VAO.22",svcReqL:[]};function Z({onAddressSelect:t}){const[s,o]=h.useState(null),[i,l]=h.useState(""),[x,d]=h.useState(null);if(h.useRef(null),S({click:n=>{console.log("üó∫Ô∏è Map clicked at:",n.latlng),o(n.latlng),l("Uƒçitavanje adrese..."),d(null);const{x:a,y:u}=X(n.latlng.lat,n.latlng.lng);console.log("üìç Projected coordinates:",{x:a,y:u}),(async()=>{const R={...E,client:{...E.client,pos:{x:a,y:u,acc:20}},svcReqL:[{meth:"LocGeoPos",req:{ring:{cCrd:{x:a,y:u},minDist:0,maxDist:30},maxLoc:1,locFltrL:[{type:"PROD",mode:"INC",value:4087}],getPOIs:!0},id:"1|5|"}]};try{const r=await(await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)})).json();if(r&&r.svcResL&&r.svcResL.length>0&&r.svcResL[0].res&&r.svcResL[0].res.locL&&r.svcResL[0].res.locL.length>0){const f=r.svcResL[0].res.locL[0];let c=f.nameFormatted&&f.nameFormatted.text||f.name||f.txt||"";/^-?\d+\.\d+, ?-?\d+\.\d+$/.test(c)&&(c="Nema adrese za ovu lokaciju"),l(c||"Adresa pronaƒëena"),d({geoData:r,x:a,y:u});let A=c,j="";if(c&&c.includes(",")){const C=c.split(",");A=C[0].trim(),j=C.slice(1).join(",").trim()}const T={address:A,city:j,lat:n.latlng.lat,lon:n.latlng.lng};console.log("üéØ ClickToVORAddress calling onAddressSelect:",T),t&&t(T);return}const P={...E,client:{...E.client,pos:{x:a,y:u,acc:20}},svcReqL:[{meth:"LocMatch",req:{input:{field:"S",loc:{type:"C",crd:{x:a,y:u}},maxLoc:1,locFltrL:[{type:"META",value:"in_austria_test"}]}},id:"1|24|"}]},_=await(await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)})).json();if(d({matchData:_,x:a,y:u}),_&&_.svcResL&&_.svcResL.length>0&&_.svcResL[0].res&&_.svcResL[0].res.match&&_.svcResL[0].res.match.locL&&_.svcResL[0].res.match.locL.length>0){const f=_.svcResL[0].res.match.locL[0];let c=f.nameFormatted&&f.nameFormatted.text||f.name||f.txt||"";/^-?\d+\.\d+, ?-?\d+\.\d+$/.test(c)&&(c="Nema adrese za ovu lokaciju"),l(c||"Adresa pronaƒëena");let A=c,j="";if(c&&c.includes(",")){const T=c.split(",");A=T[0].trim(),j=T.slice(1).join(",").trim()}t&&t({address:A,city:j,lat:n.latlng.lat,lon:n.latlng.lng});return}l("Adresa nije pronaƒëena"),t&&t({address:"",city:"",lat:n.latlng.lat,lon:n.latlng.lng})}catch(p){l("Gre≈°ka pri dohvaƒáanju adrese: "+((p==null?void 0:p.message)||JSON.stringify(p))),d(p),t&&t({address:"",city:"",lat:n.latlng.lat,lon:n.latlng.lng})}})()},move:()=>{o(null),l(""),g(!1)}}),i&&i.includes(",")){const n=i.split(",");n[0].trim(),n.slice(1).join(",").trim()}s==null||s.lat,s==null||s.lng;const[v,g]=h.useState(!0);return S({}),s?e.jsx(Y,{center:s,radius:7,pathOptions:{color:"#0ea5e9",fillColor:"#0ea5e9",fillOpacity:.92,weight:1.5}}):null}function M(t){if(t==null)return null;if(t>=1e3){const s=t/1e3;return new Intl.NumberFormat("de-DE",{maximumFractionDigits:1}).format(s)+" km"}return`${t} m`}function N(t){if(t==null)return null;const s=Math.round(t/60);if(s>=60){const o=Math.floor(s/60),i=s%60;return i>0?`${o}h ${i}min`:`${o}h`}return`${s} min`}let J=L.divIcon({html:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z" fill="#ef4444" stroke="#dc2626" stroke-width="2"/>
    <circle cx="12" cy="10" r="3" fill="white"/>
  </svg>`,className:"custom-div-icon",iconSize:[24,24],iconAnchor:[12,24]});L.Marker.prototype.options.icon=J;function tt({address:t,lat:s,lon:o,onClose:i,routeInfo:l,userLocation:x}){let d=t,v="";if(t&&t.includes(",")){const a=t.split(",");d=a[0].trim(),v=a.slice(1).join(",").trim()}const g=s&&o?`https://www.google.com/maps/search/?api=1&query=${s},${o}`:"#";let n=null;if(l&&l.distanceMeters&&l.durationSeconds){const a=l.durationText||N(l.durationSeconds)||"--",u=l.distanceText||M(l.distanceMeters)||"--";n=`${a} ‚Ä¢ ${u}`}else if(l&&l.distance&&l.duration){const a=N(l.duration)||"--",u=M(l.distance)||"--";n=`${a} ‚Ä¢ ${u}`}else if(x&&s&&o){const u=(s-x[0])*Math.PI/180,R=(o-x[1])*Math.PI/180,p=Math.sin(u/2)*Math.sin(u/2)+Math.cos(x[0]*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(R/2)*Math.sin(R/2),P=6371*(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p))),w=Math.round(P*1e3),f=w>0?Math.round(P/40*3600):null,c=f?N(f):"--",A=M(w);n=`${c} ‚Ä¢ ${A}`}return e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl p-4 min-w-[240px] max-w-[320px] border border-gray-100 relative z-50",onMouseDown:a=>a.stopPropagation(),onClick:a=>a.stopPropagation(),children:[e.jsx("button",{onClick:a=>{a.preventDefault(),a.stopPropagation(),i()},onMouseDown:a=>{a.preventDefault(),a.stopPropagation()},className:"absolute -top-2 -right-2 w-8 h-8 flex items-center justify-center bg-gray-800 text-white hover:bg-gray-900 rounded-full shadow-lg transition-all duration-200 hover:scale-105 z-50","aria-label":"Zatvori popup",title:"Zatvori",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 leading-tight",children:d}),v&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:v})]})}),n&&e.jsx("div",{className:"flex items-center justify-center py-2 px-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-100",children:e.jsx("div",{className:"text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:n})}),e.jsx("button",{onClick:()=>window.open(g,"_blank"),className:"w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]",children:"Pokreni navigaciju"})]})]})}function et({position:t,address:s,speed:o=0,heading:i=0,isFullscreen:l=!1}){if(!t)return null;const x=()=>o>1?L.divIcon({html:`
          <div style="transform: rotate(${i}deg); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
            <div style="width: 32px; height: 32px; background: #3b82f6; border: 4px solid white; border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                <path d="M12 2l8 20-8-6-8 6 8-20z"/>
              </svg>
            </div>
          </div>
        `,className:"custom-location-marker",iconSize:[32,32],iconAnchor:[16,16]}):L.divIcon({html:`
          <div style="width: 16px; height: 16px; background: #3b82f6; border: 2px solid white; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.3); animation: pulse 2s infinite;">
          </div>
          <style>
            @keyframes pulse {
              0% { opacity: 1; }
              50% { opacity: 0.5; }
              100% { opacity: 1; }
            }
          </style>
        `,className:"custom-location-marker-static",iconSize:[16,16],iconAnchor:[8,8]});return e.jsx(B,{position:t,icon:x(),children:e.jsx(z,{children:typeof s<"u"&&s?String(s):"Moja lokacija"})})}function st({marker:t,onAddressSelect:s,routeInfo:o,userLocation:i}){var d,v,g;const l=h.useRef();if(h.useEffect(()=>{l.current&&t&&t.lat&&t.lon&&setTimeout(()=>{l.current.openPopup()},100)},[t==null?void 0:t.lat,t==null?void 0:t.lon]),!t||!t.lat||!t.lon)return null;const x=[t.lat,t.lon];return e.jsx(B,{position:x,ref:l,children:e.jsx(z,{autoPan:!0,autoClose:!1,closeOnClick:!1,children:e.jsx(tt,{address:((v=(d=t.data)==null?void 0:d.nameFormatted)==null?void 0:v.text)||((g=t.data)==null?void 0:g.name)||t.label||`${String(t.address||"")}${t.city?`, ${String(t.city)}`:""}`,lat:t.lat,lon:t.lon,routeInfo:o,userLocation:i,onClose:()=>{s&&s(null)}})})})}function at({onAddressSelect:t,mapRef:s,selectedMarker:o,userLocation:i,routeInfo:l,currentAddress:x,speed:d,heading:v,isFullscreen:g}){const n=h.useRef(),a=s||n,u=h.useCallback(R=>{a&&(a.current=R)},[a]);return e.jsx("div",{className:"relative w-full h-full bg-gray-100",children:e.jsxs("div",{className:"w-full h-full",children:[e.jsxs(q,{center:[47.0707,15.4395],zoom:8,className:"w-full h-full z-0",ref:u,maxZoom:18,minZoom:6,zoomControl:!1,attributionControl:!1,children:[e.jsx(H,{url:"https://maps.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png",attribution:'Datenquelle: <a href="https://www.basemap.at">basemap.at</a>',maxZoom:19}),e.jsx(Q,{}),i&&e.jsx(et,{position:i,address:x,speed:d,heading:v,isFullscreen:g}),o&&e.jsx(st,{marker:o,onAddressSelect:t,routeInfo:l,userLocation:i}),e.jsx(Z,{onAddressSelect:t})]}),typeof d<"u"&&g&&e.jsx("div",{className:"absolute right-6 bottom-6 bg-white/95 backdrop-blur-sm border border-slate-300 rounded-2xl px-4 py-3 shadow-xl z-1000",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg text-slate-800",children:d?(d*3.6).toFixed(1):"0"}),e.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"km/h"})]})})]})})}const nt=async t=>{if(!t)return null;try{const o=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}&countrycodes=at`)).json();return o.length>0?o[0]:null}catch(s){return console.error("Gre≈°ka pri tra≈æenju adrese:",s),null}},rt=()=>{const t=K();h.useRef(null);const[s,o]=h.useState(""),[i,l]=h.useState(!1),[x,d]=h.useState(null),[v,g]=h.useState([47.0707,15.4395]),[n,a]=h.useState(null);h.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(p=>{const r=[p.coords.latitude,p.coords.longitude];d(r),g(r)},p=>console.warn("Geolocation error:",p))},[]);const u=async p=>{var P,w;if(p.preventDefault(),!s.trim())return;l(!0);const r=await nt(s);if(l(!1),r){const _=parseFloat(r.lat),f=parseFloat(r.lon),c=[_,f];a({address:r.display_name,city:((P=r.address)==null?void 0:P.city)||((w=r.address)==null?void 0:w.town)||"",lat:_,lon:f}),g(c)}else alert("Adresa nije pronaƒëena. Poku≈°ajte detaljnije (npr. Ulica, Grad).")},R=()=>{o(""),a(null),x&&g(x)};return e.jsxs("div",{className:"h-screen w-full flex flex-col bg-slate-900 relative",children:[e.jsxs("div",{className:"absolute top-4 left-4 right-4 z-[1000] flex gap-2 items-start max-w-2xl mx-auto w-full",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-3 bg-slate-800/90 backdrop-blur-md text-white rounded-xl shadow-lg border border-slate-700 hover:bg-slate-700 transition-colors",children:e.jsx(V,{size:20})}),e.jsxs("form",{onSubmit:u,className:"flex-1 bg-slate-800/90 backdrop-blur-md rounded-xl shadow-lg border border-slate-700 flex items-center p-1",children:[e.jsx("div",{className:"p-2 text-slate-400",children:e.jsx(F,{size:20})}),e.jsx("input",{type:"text",value:s,onChange:p=>o(p.target.value),placeholder:"Pretra≈æi adresu (npr. Graz, Hauptplatz)...",className:"flex-1 bg-transparent border-none outline-none text-white placeholder-slate-400 px-2 py-2"}),s&&e.jsx("button",{type:"button",onClick:R,className:"p-2 text-slate-400 hover:text-white transition-colors",children:e.jsx($,{size:18})}),e.jsx("button",{type:"submit",disabled:i,className:"bg-blue-600 text-white px-4 py-2 rounded-lg ml-1 hover:bg-blue-700 transition-colors disabled:opacity-50 font-medium",children:i?"...":"Tra≈æi"})]})]}),e.jsx("div",{className:"flex-1 w-full h-full relative z-0",children:e.jsx(at,{center:v,zoom:15,userLocation:x,selectedAddress:n,theme:"night"})}),n&&e.jsx(D.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},className:"absolute bottom-4 left-4 right-4 z-[1000] max-w-2xl mx-auto",children:e.jsx("div",{className:"bg-slate-800/95 backdrop-blur-md p-4 rounded-xl border border-slate-700 shadow-xl text-white",children:e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg pr-8 line-clamp-2",children:n.address.split(",")[0]}),e.jsx("p",{className:"text-slate-400 text-sm mt-1 line-clamp-1",children:n.address})]}),e.jsx("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${n.lat},${n.lon}`,target:"_blank",rel:"noreferrer",className:"bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition-transform active:scale-95 flex-shrink-0",children:e.jsx(G,{size:24})})]})})})]})};export{rt as default};

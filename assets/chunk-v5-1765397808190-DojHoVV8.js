import{j as t,A as ae,m as I,i as oe,N as be}from"./chunk-v5-1765397808190-_1LasmOE.js";import{r as m,u as Ae}from"./chunk-v5-1765397808190-DzTHeiPn.js";import{u as we,a as re,C as _e,M as Te,T as Se,b as he,P as ue,L as Y}from"./chunk-v5-1765397808190-DzbslpSY.js";const le={VITE_GITHUB_REPO:"eldin007b/gls-scraper",VITE_GITHUB_TOKEN:"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",VITE_MAPQUEST_API_KEY:"",VITE_MAPQUEST_PROXY_URL:"https://dsltpiupbfopyvuiqffg.supabase.co/functions/v1/mapquest-proxy",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzbHRwaXVwYmZvcHl2dWlxZmZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5Mjc3MzcsImV4cCI6MjA2NTUwMzczN30.suu_OSbTBSEkM3YMiPDFIAgDnX3bDavcD8BX4ZfYZxw",VITE_SUPABASE_URL:"https://dsltpiupbfopyvuiqffg.supabase.co",VITE_WORKFLOW_FILE:"scraper.yml"};var ce={};const x=typeof import.meta<"u"&&le?le:{},L=typeof process<"u"&&ce?ce:{},Ee="https://dsltpiupbfopyvuiqffg.supabase.co",Pe="",Re="https://dsltpiupbfopyvuiqffg.supabase.co/functions/v1",M={SUPABASE_URL:x.VITE_SUPABASE_URL||x.REACT_APP_SUPABASE_URL||L.REACT_APP_SUPABASE_URL||Ee,SUPABASE_KEY:x.VITE_SUPABASE_ANON_KEY||x.VITE_SUPABASE_KEY||x.REACT_APP_SUPABASE_KEY||L.REACT_APP_SUPABASE_KEY||Pe,API_BASE_URL:x.VITE_API_BASE_URL||x.REACT_APP_API_BASE_URL||L.REACT_APP_API_BASE_URL||Re,GOOGLE_MAPS_API_KEY:x.VITE_GOOGLE_MAPS_API_KEY||x.REACT_APP_GOOGLE_MAPS_API_KEY||L.REACT_APP_GOOGLE_MAPS_API_KEY||""};M.MAPQUEST_API_KEY=x.VITE_MAPQUEST_API_KEY||x.REACT_APP_MAPQUEST_API_KEY||L.REACT_APP_MAPQUEST_API_KEY||"";M.MAPQUEST_PROXY_URL=x.VITE_MAPQUEST_PROXY_URL||x.REACT_APP_MAPQUEST_PROXY_URL||L.REACT_APP_MAPQUEST_PROXY_URL||`${M.API_BASE_URL}/mapquest-proxy`;M.GITHUB_TOKEN=x.VITE_GITHUB_TOKEN||x.REACT_APP_GITHUB_TOKEN||L.REACT_APP_GITHUB_TOKEN||"";M.GITHUB_REPO=x.VITE_GITHUB_REPO||x.REACT_APP_GITHUB_REPO||L.REACT_APP_GITHUB_REPO||"eldin007b/gls-scraper";M.WORKFLOW_FILE=x.VITE_WORKFLOW_FILE||x.REACT_APP_WORKFLOW_FILE||L.REACT_APP_WORKFLOW_FILE||"scraper.yml";M.ROUTE_STRATEGY=x.VITE_ROUTE_STRATEGY||x.REACT_APP_ROUTE_STRATEGY||L.REACT_APP_ROUTE_STRATEGY||"";M.VORANACHB_URL=x.VITE_VORANACHB_URL||x.REACT_APP_VORANACHB_URL||L.REACT_APP_VORANACHB_URL||"";async function je(i){var s,n,a,c;const e={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:14289510,y:46624050,acc:16.185}},formatted:!1,ext:"VAO.22",svcReqL:[{meth:"LocMatch",req:{input:{field:"S",loc:{type:"ALL",dist:1e3,name:i},maxLoc:7}},id:"1|43|"}]};try{const u=await fetch(`${M.API_BASE_URL}/vor-proxy`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});console.debug("[AddressSearchService] vor-proxy status:",u.status);try{const d=await u.text();console.debug("[AddressSearchService] vor-proxy response (preview):",d.slice(0,1e3));const f=d?JSON.parse(d):null;return((c=(a=(n=(s=f==null?void 0:f.svcResL)==null?void 0:s[0])==null?void 0:n.res)==null?void 0:a.match)==null?void 0:c.locL)||[]}catch(d){console.warn("[AddressSearchService] Failed to parse vor-proxy response as JSON",d)}}catch(u){console.warn("VAO proxy failed, falling back to Nominatim",u)}try{const u=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(i)}&format=json&addressdetails=1&limit=8&accept-language=de`,d=await fetch(u,{headers:{"User-Agent":"bde-evidencija/1.0 (+https://eldin007b.github.io/bde-evidencija)"}});return d.ok?(await d.json()).map(r=>({name:r.display_name,nameFormatted:{text:r.display_name},crd:{x:Math.round(r.lon*1e6),y:Math.round(r.lat*1e6)}})):[]}catch(u){return console.warn("Nominatim fallback failed",u),[]}}function H(i){if(i==null)return null;if(i>=1e3){const e=i/1e3;return new Intl.NumberFormat("de-DE",{maximumFractionDigits:1}).format(e)+" km"}return`${i} m`}function W(i){if(i==null)return null;const e=Math.round(i/60);if(e>=60){const s=Math.floor(e/60),n=e%60;return n>0?`${s}h ${n}min`:`${s}h`}return`${e} min`}class Le{constructor(){this.isAppVisible=!0,this.listeners=new Set,this.lastActivity=Date.now(),this.activityTimeout=null,this.gpsConfig={foreground:{enableHighAccuracy:!0,maximumAge:1e3,timeout:5e3,updateInterval:1e3},background:{enableHighAccuracy:!1,maximumAge:1e4,timeout:3e4,updateInterval:3e4},inactive:{enableHighAccuracy:!1,maximumAge:6e4,timeout:6e4,updateInterval:12e4}},this.currentMode="foreground",this.init()}init(){document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),window.addEventListener("focus",this.handleFocus.bind(this)),window.addEventListener("blur",this.handleBlur.bind(this)),this.trackUserActivity(),console.log("üîã [Battery] Service inicijalizovan")}handleVisibilityChange(){this.isAppVisible=!document.hidden,this.updateMode(),console.log("üîã [Battery] Visibility changed:",this.isAppVisible?"visible":"hidden")}handleFocus(){this.isAppVisible=!0,this.updateActivity(),this.updateMode(),console.log("üîã [Battery] App focused")}handleBlur(){this.isAppVisible=!1,this.updateMode(),console.log("üîã [Battery] App blurred")}trackUserActivity(){const e=["mousedown","mousemove","keypress","scroll","touchstart","click"],s=()=>{this.updateActivity()};e.forEach(n=>{document.addEventListener(n,s,{passive:!0})})}updateActivity(){this.lastActivity=Date.now(),this.activityTimeout&&clearTimeout(this.activityTimeout),this.activityTimeout=setTimeout(()=>{this.updateMode()},5*60*1e3),this.updateMode()}updateMode(){const n=Date.now()-this.lastActivity>5*60*1e3;let a;if(this.isAppVisible?n?a="inactive":a="foreground":a="background",a!==this.currentMode){const c=this.currentMode;this.currentMode=a,console.log(`üîã [Battery] Mode changed: ${c} ‚Üí ${a}`),this.notifyListeners({type:"mode_changed",oldMode:c,newMode:a,config:this.getCurrentConfig()})}}getCurrentConfig(){return this.gpsConfig[this.currentMode]}getCurrentMode(){return this.currentMode}addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(e){this.listeners.forEach(s=>{try{s(e)}catch(n){console.error("üîã [Battery] Error in listener:",n)}})}async getBatteryInfo(){if("getBattery"in navigator)try{const e=await navigator.getBattery();return{level:Math.round(e.level*100),charging:e.charging,chargingTime:e.chargingTime,dischargingTime:e.dischargingTime}}catch(e){console.warn("üîã [Battery] Battery API not available:",e)}return null}async getAdaptiveGpsConfig(){const e=await this.getBatteryInfo(),s=this.getCurrentConfig();return e&&e.level<20&&!e.charging?{...s,enableHighAccuracy:!1,maximumAge:6e4,updateInterval:Math.max(s.updateInterval*2,6e4)}:e&&e.level<50&&!e.charging?{...s,maximumAge:Math.max(s.maximumAge*1.5,5e3),updateInterval:Math.max(s.updateInterval*1.5,5e3)}:s}destroy(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("focus",this.handleFocus),window.removeEventListener("blur",this.handleBlur),this.activityTimeout&&clearTimeout(this.activityTimeout),this.listeners.clear(),console.log("üîã [Battery] Service destroyed")}}new Le;function Me(i,e,s,n){const c=(s-i)*Math.PI/180,u=(n-e)*Math.PI/180,d=Math.sin(c/2)*Math.sin(c/2)+Math.cos(i*Math.PI/180)*Math.cos(s*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 6371*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}class Ce{constructor(){this.debounceDelay=2e3,this.minDistanceThreshold=.05,this.speedAdaptiveThresholds={walking:{speed:5,distance:.02,delay:1500},cycling:{speed:20,distance:.05,delay:2e3},driving:{speed:50,distance:.1,delay:3e3},highway:{speed:80,distance:.2,delay:4e3}},this.cache=new Map,this.maxCacheSize=100,this.cacheExpirationTime=10*60*1e3,this.lastPosition=null,this.lastGeocodingTime=0,this.pendingTimeout=null,this.currentSpeed=0,this.listeners=new Set,console.log("üåç [ReverseGeo] Service inicijalizovan")}async reverseGeocode(e,s,n=0,a=!1){this.currentSpeed=n;const c=Date.now(),u={lat:e,lon:s},d=this.generateCacheKey(e,s);if(!a){const r=this.getCached(d);if(r)return console.log("üåç [ReverseGeo] Served from cache:",d),this.notifyListeners({type:"result",data:r.data,source:"cache",position:u}),r.data}const f=this.getSpeedBasedThresholds(n);if(!a&&this.lastPosition){const r=Me(this.lastPosition.lat,this.lastPosition.lon,e,s);if(r<f.distance)return console.log(`üåç [ReverseGeo] Skipped - insufficient movement: ${(r*1e3).toFixed(0)}m < ${(f.distance*1e3).toFixed(0)}m`),null}return!a&&c-this.lastGeocodingTime<f.delay?(console.log(`üåç [ReverseGeo] Skipped - too soon: ${c-this.lastGeocodingTime}ms < ${f.delay}ms`),this.scheduleDelayedGeocoding(e,s,n,f.delay),null):(this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=null),await this.performGeocoding(e,s,u,d))}scheduleDelayedGeocoding(e,s,n,a){this.pendingTimeout&&clearTimeout(this.pendingTimeout),this.pendingTimeout=setTimeout(async()=>{console.log("üåç [ReverseGeo] Executing delayed geocoding"),await this.reverseGeocode(e,s,n,!0),this.pendingTimeout=null},a)}async performGeocoding(e,s,n,a){try{this.notifyListeners({type:"started",position:n});const c=await this.callReverseGeocodingAPI(e,s);return c&&(c.address||c.city)?(this.setCached(a,c),this.lastPosition=n,this.lastGeocodingTime=Date.now(),console.log(`üåç [ReverseGeo] Success for ${e.toFixed(4)}, ${s.toFixed(4)}:`,c),this.notifyListeners({type:"result",data:c,source:"api",position:n}),c):(console.warn("üåç [ReverseGeo] No valid result received"),null)}catch(c){return console.error("üåç [ReverseGeo] Error:",c),this.notifyListeners({type:"error",error:c.message,position:n}),null}finally{this.notifyListeners({type:"finished",position:n})}}getSpeedBasedThresholds(e){const s=(e||0)*3.6;return s<this.speedAdaptiveThresholds.walking.speed?this.speedAdaptiveThresholds.walking:s<this.speedAdaptiveThresholds.cycling.speed?this.speedAdaptiveThresholds.cycling:s<this.speedAdaptiveThresholds.driving.speed?this.speedAdaptiveThresholds.driving:this.speedAdaptiveThresholds.highway}generateCacheKey(e,s){return`${e.toFixed(3)},${s.toFixed(3)}`}getCached(e){const s=this.cache.get(e);if(s){const n=Date.now();if(n-s.timestamp<this.cacheExpirationTime)return s.lastAccessed=n,s;this.cache.delete(e)}return null}setCached(e,s){const n=Date.now();this.cache.size>=this.maxCacheSize&&this.cleanupCache(),this.cache.set(e,{data:s,timestamp:n,lastAccessed:n})}cleanupCache(){const e=Array.from(this.cache.entries());e.sort((n,a)=>n[1].lastAccessed-a[1].lastAccessed);const s=Math.floor(e.length*.25);for(let n=0;n<s;n++)this.cache.delete(e[n][0]);console.log(`üåç [ReverseGeo] Cache cleanup: removed ${s} entries`)}async callReverseGeocodingAPI(e,s){var n,a,c,u,d,f,r,h,p,g,A,T;try{const P=Math.round(s*1e6),b=Math.round(e*1e6),v=`${M.API_BASE_URL}/vor-proxy`,y={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:P,y:b,acc:20}},formatted:!1,ext:"VAO.22",svcReqL:[]},l={...y,svcReqL:[{meth:"LocGeoPos",req:{ring:{cCrd:{x:P,y:b},minDist:0,maxDist:30},locL:[{type:"S",mode:["foot","bike","car"]},{type:"P"},{type:"A"}],maxLoc:1,getPOIs:!1,getStops:!1}}]},w=await fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(w.ok){const S=await w.json();if((u=(c=(a=(n=S==null?void 0:S.svcResL)==null?void 0:n[0])==null?void 0:a.res)==null?void 0:c.locL)!=null&&u[0]){const C=S.svcResL[0].res.locL[0];if(C.name){const R=C.name.split(","),U=((d=R[0])==null?void 0:d.trim())||"";let N="";return R.length>1&&(N=R.slice(1).join(",").trim()),{address:U,city:N}}}}const _={...y,svcReqL:[{meth:"LocMatch",req:{input:{loc:{name:"",crd:{x:P,y:b},type:"C"},field:"S"}}}]},E=await fetch(v,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)});if(E.ok){const S=await E.json();if((g=(p=(h=(r=(f=S==null?void 0:S.svcResL)==null?void 0:f[0])==null?void 0:r.res)==null?void 0:h.match)==null?void 0:p.locL)!=null&&g[0]){const C=S.svcResL[0].res.match.locL[0];if(C.name){const R=C.name.split(","),U=((A=R[0])==null?void 0:A.trim())||"";let N="";return R.length>1&&(N=R.slice(1).join(",").trim()),{address:U,city:N}}}}return{address:"",city:""}}catch(P){console.error("üåç [ReverseGeo] VAO API Error:",P);try{console.log("üåç [ReverseGeo] Trying Nominatim fallback...");const b=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${s}&accept-language=de,en&addressdetails=1`);if(b.ok){const v=await b.json();if(console.log("üåç [ReverseGeo] Nominatim fallback response:",v),v.display_name){let y=v.display_name;if(v.address){const l=v.address;let w="";l.house_number&&l.road?w=`${l.road} ${l.house_number}`:l.road?w=l.road:l.suburb&&(w=l.suburb);let _="";return l.postcode&&l.city?_=`${l.postcode} ${l.city}`:l.city?_=l.city:l.town?_=l.town:l.village&&(_=l.village),{address:w||y.split(",")[0],city:_||""}}return{address:y.split(",")[0]||"",city:((T=y.split(",")[1])==null?void 0:T.trim())||""}}}}catch(b){console.error("üåç [ReverseGeo] Nominatim fallback also failed:",b)}return{address:`${e.toFixed(6)}, ${s.toFixed(6)}`,city:"Koordinaten"}}}addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(e){this.listeners.forEach(s=>{try{s(e)}catch(n){console.error("üåç [ReverseGeo] Listener error:",n)}})}getStats(){return{cacheSize:this.cache.size,maxCacheSize:this.maxCacheSize,lastPosition:this.lastPosition,lastGeocodingTime:this.lastGeocodingTime,currentSpeed:this.currentSpeed,currentThresholds:this.getSpeedBasedThresholds(this.currentSpeed),isPending:!!this.pendingTimeout}}clearCache(){this.cache.clear(),console.log("üåç [ReverseGeo] Cache cleared")}setThresholds(e){Object.assign(this.speedAdaptiveThresholds,e),console.log("üåç [ReverseGeo] Custom thresholds applied:",e)}destroy(){this.pendingTimeout&&clearTimeout(this.pendingTimeout),this.cache.clear(),this.listeners.clear(),console.log("üåç [ReverseGeo] Service destroyed")}}const O=new Ce;function Ie(){const[i,e]=m.useState(!1),[s,n]=m.useState(null),[a,c]=m.useState(null),[u,d]=m.useState(null);m.useEffect(()=>{const p=A=>{switch(A.type){case"started":e(!0),c(null);break;case"result":n(A.data),e(!1);break;case"error":c(A.error),e(!1);break;case"finished":e(!1);break}},g=O.addListener(p);return d(O.getStats()),g},[]);const f=async(p,g,A,T=!1)=>await O.reverseGeocode(p,g,A,T),r=()=>{d(O.getStats())};return{isLoading:i,lastResult:s,error:a,stats:u,reverseGeocode:f,refreshStats:r,clearCache:()=>{O.clearCache(),r()},service:O}}const Ne=({children:i,className:e="",style:s,initialCenter:n=[45.815399,15.966568],initialZoom:a=13,hideSearchAndInfo:c=!1,hideNavigation:u=!1,hideControls:d=!1,mapService:f="osm",onSearchSelect:r,onNavigate:h,mapRef:p,onLocateMe:g,autoLocate:A=!0})=>{const[T,P]=m.useState(""),[b,v]=m.useState(""),[y,l]=m.useState([]),[w,_]=m.useState(null),[E,S]=m.useState(!1),[C,R]=m.useState(!1),[U,N]=m.useState(!1),[Fe,J]=m.useState(!1),[De,Ke]=m.useState({top:0,left:0,width:0}),B=m.useRef(null),pe=m.useRef(null);m.useRef(null),m.useRef(!1),Ie();const ge=async o=>{if(!o||o.length<3){l([]);return}N(!0);try{const j=await je(o);l(j||[])}catch(j){console.error("Search error",j),l([])}finally{N(!1)}};m.useEffect(()=>{const o=setTimeout(()=>{b&&b.length>=3?ge(b):l([])},250);return()=>clearTimeout(o)},[b]);const me=o=>{const j=o.target?o.target.value:o;v(j)},fe=o=>{var j,k,G,Z,X;try{const F=(j=o==null?void 0:o.crd)==null?void 0:j.x,Q=(k=o==null?void 0:o.crd)==null?void 0:k.y;if(typeof F=="number"&&typeof Q=="number"&&((G=p==null?void 0:p.current)!=null&&G.setView)){const ee=Q/1e6,te=F/1e6;p.current.setView([ee,te],17);const V=((Z=o==null?void 0:o.nameFormatted)==null?void 0:Z.text)||(o==null?void 0:o.name)||"";let D=V,$="";const se=/<br\s*\/?.*?>/i;if(se.test(V)){const z=V.split(se);D=z[0].trim(),$=z.slice(1).join(" ").trim()}else if(V.includes(",")){const z=V.split(",");D=z[0].trim(),$=z.slice(1).join(",").trim()}const ie=D+($?`, ${$}`:"");v(ie);const ne={address:D,city:$,lat:ee,lon:te,data:o,label:ie};_(ne),r&&r(ne),l([]),J(!0),R(!1),B.current&&B.current.blur();return}o!=null&&o.lat&&(o!=null&&o.lon)&&((X=p==null?void 0:p.current)!=null&&X.setView)&&p.current.setView([o.lat,o.lon],17);const q=(o==null?void 0:o.label)||(o==null?void 0:o.name)||"";v(q),_({...o,label:q}),r&&r({...o,label:q}),l([]),J(!0),R(!1),B.current&&B.current.blur()}catch(F){console.error("handleSuggestionClick error",F)}},ve=()=>{b.trim()&&h&&h(b.trim())},ye=E?{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999}:{},xe=()=>t.jsx("div",{className:"space-y-4",children:t.jsxs("div",{className:"relative w-full z-50",children:[t.jsxs("div",{className:`
            flex items-center gap-3 px-4 py-3.5
            bg-white rounded-2xl shadow-xl border border-gray-100
            transition-all duration-300 ease-in-out
            ${C?"ring-2 ring-blue-500/20 scale-[1.01]":"hover:shadow-lg hover:border-blue-100"}
          `,children:[t.jsx("div",{className:`
              p-2 rounded-xl transition-colors duration-300
              ${C?"bg-blue-50 text-blue-600":"bg-gray-50 text-gray-400"}
          `,children:U?t.jsxs("svg",{className:"w-5 h-5 animate-spin",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}):t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[t.jsx("path",{d:"M21 21l-4.35-4.35"}),t.jsx("circle",{cx:"11",cy:"11",r:"6"})]})}),t.jsx("input",{ref:B,type:"text",value:b,onChange:o=>me(o),onFocus:()=>R(!0),placeholder:"Pretra≈æi adresu ili mjesto...",className:"flex-1 bg-transparent border-none outline-none text-gray-800 placeholder-gray-400 text-base font-medium h-full"}),t.jsx(ae,{children:b&&t.jsx(I.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:()=>{var o;v(""),l([]),(o=B.current)==null||o.focus()},className:"p-1.5 rounded-full bg-gray-100 text-gray-400 hover:bg-gray-200 hover:text-gray-600 transition-colors",children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:t.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})})]}),t.jsx(ae,{children:y.length>0&&C&&t.jsxs(I.div,{initial:{opacity:0,y:8,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:8,scale:.98},transition:{duration:.2},className:"absolute top-full left-0 right-0 mt-3 bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden max-h-[320px] overflow-y-auto custom-scrollbar",children:[t.jsx("div",{className:"py-2",children:y.map((o,j)=>{var k,G;return t.jsxs(I.button,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:j*.03},onClick:()=>fe(o),className:"w-full text-left px-4 py-3 hover:bg-blue-50/50 transition-colors flex items-start gap-3 group border-b border-gray-50 last:border-0",children:[t.jsx("div",{className:"mt-1 p-2 rounded-full bg-gray-50 text-gray-400 group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors",children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:t.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5 7 13 7 13s7-8 7-13c0-3.87-3.13-7-7-7z"})})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"font-semibold text-gray-800 truncate group-hover:text-blue-700 transition-colors",children:o.name||o.address&&o.address.label||""}),t.jsx("p",{className:"text-sm text-gray-500 truncate mt-0.5",children:[(k=o.address)==null?void 0:k.postcode,(G=o.address)==null?void 0:G.city].filter(Boolean).join(" ")})]}),t.jsx("div",{className:"self-center opacity-0 group-hover:opacity-100 transition-opacity text-blue-400",children:t.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:t.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})})]},j)})}),t.jsxs("div",{className:"bg-gray-50 px-4 py-2 text-[10px] text-gray-400 font-medium uppercase tracking-wider text-center border-t border-gray-100",children:["Pronaƒëeno ",y.length," rezultata"]})]})})]})});return t.jsxs("div",{className:`map-card-modern ${e}`,style:s,children:[t.jsx("div",{className:"p-4 bg-transparent",children:!c&&t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsx("div",{className:"mb-3",children:t.jsx("h3",{className:"text-sm font-medium text-slate-700",children:"Pronaƒëi rutu do odredi≈°ta"})}),xe(),t.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[t.jsx("button",{className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-blue-500 to-indigo-500 text-white font-semibold shadow hover:shadow-lg transform hover:scale-[1.01] active:scale-95",onClick:ve,disabled:!b.trim(),title:"Otvori navigaciju",children:"Otvori navigaciju"}),t.jsx("button",{className:"px-4 py-3 rounded-2xl bg-white border border-gray-100 text-sm text-gray-700 hover:shadow-sm",onClick:()=>{v(""),l([])},title:"Oƒçisti",children:"Oƒçisti"}),t.jsx("button",{className:"ml-auto px-3 py-2 rounded-2xl bg-white border border-gray-100 text-sm text-gray-700 hover:shadow-sm",onClick:()=>S(o=>!o),title:E?"Izaƒëi iz punog ekrana":"Puni ekran",children:E?"Izaƒëi":"Puni ekran"})]})]})}),t.jsx("div",{ref:pe,style:ye,className:"map-content relative",children:i})]})},Be=()=>{const i=we();return m.useEffect(()=>{setTimeout(()=>{i.invalidateSize()},200)},[i]),null};function Oe(i,e){const s=Math.round(e*1e6),n=Math.round(i*1e6);return{x:s,y:n}}const de=`${M.API_BASE_URL}/vor-proxy`,K={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:14289513,y:46624058,acc:20}},formatted:!1,ext:"VAO.22",svcReqL:[]};function Ue({onAddressSelect:i}){const[e,s]=m.useState(null),[n,a]=m.useState(""),[c,u]=m.useState(null);if(m.useRef(null),re({click:r=>{console.log("üó∫Ô∏è Map clicked at:",r.latlng),s(r.latlng),a("Uƒçitavanje adrese..."),u(null);const{x:h,y:p}=Oe(r.latlng.lat,r.latlng.lng);console.log("üìç Projected coordinates:",{x:h,y:p}),(async()=>{const g={...K,client:{...K.client,pos:{x:h,y:p,acc:20}},svcReqL:[{meth:"LocGeoPos",req:{ring:{cCrd:{x:h,y:p},minDist:0,maxDist:30},maxLoc:1,locFltrL:[{type:"PROD",mode:"INC",value:4087}],getPOIs:!0},id:"1|5|"}]};try{const T=await(await fetch(de,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).json();if(T&&T.svcResL&&T.svcResL.length>0&&T.svcResL[0].res&&T.svcResL[0].res.locL&&T.svcResL[0].res.locL.length>0){const y=T.svcResL[0].res.locL[0];let l=y.nameFormatted&&y.nameFormatted.text||y.name||y.txt||"";/^-?\d+\.\d+, ?-?\d+\.\d+$/.test(l)&&(l="Nema adrese za ovu lokaciju"),a(l||"Adresa pronaƒëena"),u({geoData:T,x:h,y:p});let w=l,_="";if(l&&l.includes(",")){const S=l.split(",");w=S[0].trim(),_=S.slice(1).join(",").trim()}const E={address:w,city:_,lat:r.latlng.lat,lon:r.latlng.lng};console.log("üéØ ClickToVORAddress calling onAddressSelect:",E),i&&i(E);return}const P={...K,client:{...K.client,pos:{x:h,y:p,acc:20}},svcReqL:[{meth:"LocMatch",req:{input:{field:"S",loc:{type:"C",crd:{x:h,y:p}},maxLoc:1,locFltrL:[{type:"META",value:"in_austria_test"}]}},id:"1|24|"}]},v=await(await fetch(de,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)})).json();if(u({matchData:v,x:h,y:p}),v&&v.svcResL&&v.svcResL.length>0&&v.svcResL[0].res&&v.svcResL[0].res.match&&v.svcResL[0].res.match.locL&&v.svcResL[0].res.match.locL.length>0){const y=v.svcResL[0].res.match.locL[0];let l=y.nameFormatted&&y.nameFormatted.text||y.name||y.txt||"";/^-?\d+\.\d+, ?-?\d+\.\d+$/.test(l)&&(l="Nema adrese za ovu lokaciju"),a(l||"Adresa pronaƒëena");let w=l,_="";if(l&&l.includes(",")){const E=l.split(",");w=E[0].trim(),_=E.slice(1).join(",").trim()}i&&i({address:w,city:_,lat:r.latlng.lat,lon:r.latlng.lng});return}a("Adresa nije pronaƒëena"),i&&i({address:"",city:"",lat:r.latlng.lat,lon:r.latlng.lng})}catch(A){a("Gre≈°ka pri dohvaƒáanju adrese: "+((A==null?void 0:A.message)||JSON.stringify(A))),u(A),i&&i({address:"",city:"",lat:r.latlng.lat,lon:r.latlng.lng})}})()},move:()=>{s(null),a(""),f(!1)}}),n&&n.includes(",")){const r=n.split(",");r[0].trim(),r.slice(1).join(",").trim()}e==null||e.lat,e==null||e.lng;const[d,f]=m.useState(!0);return re({}),e?t.jsx(_e,{center:e,radius:7,pathOptions:{color:"#0ea5e9",fillColor:"#0ea5e9",fillOpacity:.92,weight:1.5}}):null}let ke=Y.divIcon({html:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z" fill="#ef4444" stroke="#dc2626" stroke-width="2"/>
    <circle cx="12" cy="10" r="3" fill="white"/>
  </svg>`,className:"custom-div-icon",iconSize:[24,24],iconAnchor:[12,24]});Y.Marker.prototype.options.icon=ke;function Ge({address:i,lat:e,lon:s,onClose:n,routeInfo:a,userLocation:c}){let u=i,d="";if(i&&i.includes(",")){const h=i.split(",");u=h[0].trim(),d=h.slice(1).join(",").trim()}const f=e&&s?`https://www.google.com/maps/search/?api=1&query=${e},${s}`:"#";let r=null;if(a&&a.distanceMeters&&a.durationSeconds){const h=a.durationText||W(a.durationSeconds)||"--",p=a.distanceText||H(a.distanceMeters)||"--";r=`${h} ‚Ä¢ ${p}`}else if(a&&a.distance&&a.duration){const h=W(a.duration)||"--",p=H(a.distance)||"--";r=`${h} ‚Ä¢ ${p}`}else if(c&&e&&s){const p=(e-c[0])*Math.PI/180,g=(s-c[1])*Math.PI/180,A=Math.sin(p/2)*Math.sin(p/2)+Math.cos(c[0]*Math.PI/180)*Math.cos(e*Math.PI/180)*Math.sin(g/2)*Math.sin(g/2),P=6371*(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A))),b=Math.round(P*1e3),y=b>0?Math.round(P/40*3600):null,l=y?W(y):"--",w=H(b);r=`${l} ‚Ä¢ ${w}`}return t.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl p-4 min-w-[240px] max-w-[320px] border border-gray-100 relative z-50",onMouseDown:h=>h.stopPropagation(),onClick:h=>h.stopPropagation(),children:[t.jsx("button",{onClick:h=>{h.preventDefault(),h.stopPropagation(),n()},onMouseDown:h=>{h.preventDefault(),h.stopPropagation()},className:"absolute -top-2 -right-2 w-8 h-8 flex items-center justify-center bg-gray-800 text-white hover:bg-gray-900 rounded-full shadow-lg transition-all duration-200 hover:scale-105 z-50","aria-label":"Zatvori popup",title:"Zatvori",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex items-start gap-3",children:t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-base font-semibold text-gray-900 leading-tight",children:u}),d&&t.jsx("div",{className:"text-sm text-gray-600 mt-1",children:d})]})}),r&&t.jsx("div",{className:"flex items-center justify-center py-2 px-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-100",children:t.jsx("div",{className:"text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:r})}),t.jsx("button",{onClick:()=>window.open(f,"_blank"),className:"w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]",children:"Pokreni navigaciju"})]})]})}function Ve({position:i,address:e,speed:s=0,heading:n=0,isFullscreen:a=!1}){if(!i)return null;const c=()=>s>1?Y.divIcon({html:`
          <div style="transform: rotate(${n}deg); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
            <div style="width: 32px; height: 32px; background: #3b82f6; border: 4px solid white; border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                <path d="M12 2l8 20-8-6-8 6 8-20z"/>
              </svg>
            </div>
          </div>
        `,className:"custom-location-marker",iconSize:[32,32],iconAnchor:[16,16]}):Y.divIcon({html:`
          <div style="width: 16px; height: 16px; background: #3b82f6; border: 2px solid white; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.3); animation: pulse 2s infinite;">
          </div>
          <style>
            @keyframes pulse {
              0% { opacity: 1; }
              50% { opacity: 0.5; }
              100% { opacity: 1; }
            }
          </style>
        `,className:"custom-location-marker-static",iconSize:[16,16],iconAnchor:[8,8]});return t.jsx(he,{position:i,icon:c(),children:t.jsx(ue,{children:typeof e<"u"&&e?String(e):"Moja lokacija"})})}function $e({marker:i,onAddressSelect:e,routeInfo:s,userLocation:n}){var u,d,f;const a=m.useRef();if(m.useEffect(()=>{a.current&&i&&i.lat&&i.lon&&setTimeout(()=>{a.current.openPopup()},100)},[i==null?void 0:i.lat,i==null?void 0:i.lon]),!i||!i.lat||!i.lon)return null;const c=[i.lat,i.lon];return t.jsx(he,{position:c,ref:a,children:t.jsx(ue,{autoPan:!0,autoClose:!1,closeOnClick:!1,children:t.jsx(Ge,{address:((d=(u=i.data)==null?void 0:u.nameFormatted)==null?void 0:d.text)||((f=i.data)==null?void 0:f.name)||i.label||`${String(i.address||"")}${i.city?`, ${String(i.city)}`:""}`,lat:i.lat,lon:i.lon,routeInfo:s,userLocation:n,onClose:()=>{e&&e(null)}})})})}function ze({onAddressSelect:i,mapRef:e,selectedMarker:s,userLocation:n,routeInfo:a,currentAddress:c,speed:u,heading:d,isFullscreen:f}){const r=m.useRef(),h=e||r,p=m.useCallback(g=>{h&&(h.current=g)},[h]);return t.jsx("div",{className:"relative w-full h-full bg-gray-100",children:t.jsxs("div",{className:"w-full h-full",children:[t.jsxs(Te,{center:[47.0707,15.4395],zoom:8,className:"w-full h-full z-0",ref:p,maxZoom:18,minZoom:6,zoomControl:!1,attributionControl:!1,children:[t.jsx(Se,{url:"https://maps.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png",attribution:'Datenquelle: <a href="https://www.basemap.at">basemap.at</a>',maxZoom:19}),t.jsx(Be,{}),n&&t.jsx(Ve,{position:n,address:c,speed:u,heading:d,isFullscreen:f}),s&&t.jsx($e,{marker:s,onAddressSelect:i,routeInfo:a,userLocation:n}),t.jsx(Ue,{onAddressSelect:i})]}),typeof u<"u"&&f&&t.jsx("div",{className:"absolute right-6 bottom-6 bg-white/95 backdrop-blur-sm border border-slate-300 rounded-2xl px-4 py-3 shadow-xl z-1000",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"font-bold text-lg text-slate-800",children:u?(u*3.6).toFixed(1):"0"}),t.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"km/h"})]})})]})})}const We=()=>{const i=Ae(),e=m.useRef(null),s=m.useRef(null),[n,a]=m.useState("night"),[c,u]=m.useState(null),[d,f]=m.useState({address:"",city:"",lat:null,lon:null}),r={night:{background:"from-slate-900 via-blue-900 to-indigo-900",accent:"from-blue-400 to-purple-400"}};m.useEffect(()=>{a("night")},[]);const h=n==="night",p=typeof window<"u"?window.innerWidth<768:!1;return m.useEffect(()=>{const g=()=>{e.current&&typeof e.current.invalidateSize=="function"&&(console.log("üó∫Ô∏è Invalidating map size..."),e.current.invalidateSize())},A=setTimeout(g,500);return window.addEventListener("resize",g),()=>{clearTimeout(A),window.removeEventListener("resize",g)}},[]),m.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(g=>u([g.coords.latitude,g.coords.longitude]),g=>console.warn("Geolocation error:",g))},[]),t.jsxs("div",{className:`min-h-screen bg-gradient-to-br ${r[n].background} transition-all duration-1000`,children:[t.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[t.jsx(I.div,{animate:{scale:[1,1.2,1],rotate:[0,90,0]},transition:{duration:20,repeat:1/0,ease:"linear"},className:`absolute top-20 left-10 w-96 h-96 bg-gradient-to-r ${r[n].accent} rounded-full mix-blend-multiply filter blur-3xl opacity-20`}),t.jsx(I.div,{animate:{scale:[1.2,1,1.2],rotate:[90,0,90]},transition:{duration:25,repeat:1/0,ease:"linear"},className:`absolute bottom-20 right-10 w-96 h-96 bg-gradient-to-r ${r[n].accent} rounded-full mix-blend-multiply filter blur-3xl opacity-20`})]}),t.jsx(I.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"relative z-10",children:t.jsx("div",{className:"flex items-center justify-between p-4 md:p-6",children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx(I.button,{onClick:()=>i(-1),whileHover:{scale:1.05},whileTap:{scale:.95},className:`p-3 rounded-xl backdrop-blur-sm border transition-all duration-200 ${h?"bg-gray-800/90 border-gray-700 text-gray-100 hover:bg-gray-700/90":"bg-white/90 border-gray-200 text-gray-700 hover:bg-white/95"} shadow-lg hover:shadow-xl`,children:t.jsx(oe,{className:"w-6 h-6"})}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-r ${r[n].accent} shadow-lg`,children:t.jsx(be,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h1",{className:`text-2xl font-bold ${h?"text-white":"text-gray-900"}`,children:"Navigacija"}),t.jsx("p",{className:`text-sm ${h?"text-gray-400":"text-gray-600"}`,children:"Mapa dostave - Austrija"})]})]})]})})}),t.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:`relative z-10 ${p?"h-screen":"px-2 md:px-6 pb-2 md:pb-6"}`,children:t.jsx("div",{className:`${p?"h-full":`rounded-lg md:rounded-2xl backdrop-blur-sm border overflow-hidden shadow-2xl h-[calc(100vh-120px)] md:h-[calc(100vh-160px)] ${h?"bg-gray-800/90 border-gray-700":"bg-white/90 border-gray-200"}`}`,children:t.jsx(Ne,{title:"Navigacija - Mapa dostave",mapRef:e,footerRef:s,className:"h-full w-full",style:{height:"100%",width:"100%"},address:(d==null?void 0:d.address)||"",city:(d==null?void 0:d.city)||"",selectedMarker:d,headerHeight:p?120:160,sidebarLayout:!p,hideSearchAndInfo:p,onNavigate:g=>{if(g&&typeof g=="object"&&typeof g.lat=="number"&&typeof g.lon=="number"){window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(`${g.lat},${g.lon}`)}&travelmode=driving`,"_blank");return}g&&window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(g)}`,"_blank")},onSearchSelect:g=>{console.log("üéØ Address selected:",g),f(g)},onLocateMe:u,children:t.jsx(ze,{onAddressSelect:g=>{console.log("üó∫Ô∏è MapView address select:",g),f(g)},mapRef:e,selectedMarker:d,userLocation:c,routeInfo:null})})})}),p&&t.jsx(I.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.2},onClick:()=>i(-1),className:"fixed top-4 left-4 z-50 p-3 rounded-2xl bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-xl hover:shadow-2xl hover:scale-105 active:scale-95 transition-all duration-200",children:t.jsx(oe,{className:"w-6 h-6 text-gray-700"})})]})};export{We as default};

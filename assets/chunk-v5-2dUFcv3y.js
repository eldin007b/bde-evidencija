import{j as e,m as K,g as Ie,N as Xe}from"./chunk-v5-4P3DX6qJ.js";import{a as u,b as et,R as Y,u as tt}from"./chunk-v5-BnSIf2SQ.js";import{u as st,a as $e,C as rt,M as ot,T as at,b as Ue,P as Fe,L as ne}from"./chunk-v5-4PRvBQsC.js";const Be={VITE_GITHUB_REPO:"eldin007b/gls-scraper",VITE_GITHUB_TOKEN:"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",VITE_MAPQUEST_API_KEY:"",VITE_MAPQUEST_PROXY_URL:"https://dsltpiupbfopyvuiqffg.supabase.co/functions/v1/mapquest-proxy",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzbHRwaXVwYmZvcHl2dWlxZmZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5Mjc3MzcsImV4cCI6MjA2NTUwMzczN30.suu_OSbTBSEkM3YMiPDFIAgDnX3bDavcD8BX4ZfYZxw",VITE_SUPABASE_URL:"https://dsltpiupbfopyvuiqffg.supabase.co",VITE_WORKFLOW_FILE:"scraper.yml"};var ze={};const T=typeof import.meta<"u"&&Be?Be:{},$=typeof process<"u"&&ze?ze:{},nt="https://dsltpiupbfopyvuiqffg.supabase.co",it="",lt="https://dsltpiupbfopyvuiqffg.supabase.co/functions/v1",E={SUPABASE_URL:T.VITE_SUPABASE_URL||T.REACT_APP_SUPABASE_URL||$.REACT_APP_SUPABASE_URL||nt,SUPABASE_KEY:T.VITE_SUPABASE_ANON_KEY||T.VITE_SUPABASE_KEY||T.REACT_APP_SUPABASE_KEY||$.REACT_APP_SUPABASE_KEY||it,API_BASE_URL:T.VITE_API_BASE_URL||T.REACT_APP_API_BASE_URL||$.REACT_APP_API_BASE_URL||lt,GOOGLE_MAPS_API_KEY:T.VITE_GOOGLE_MAPS_API_KEY||T.REACT_APP_GOOGLE_MAPS_API_KEY||$.REACT_APP_GOOGLE_MAPS_API_KEY||""};E.MAPQUEST_API_KEY=T.VITE_MAPQUEST_API_KEY||T.REACT_APP_MAPQUEST_API_KEY||$.REACT_APP_MAPQUEST_API_KEY||"";E.MAPQUEST_PROXY_URL=T.VITE_MAPQUEST_PROXY_URL||T.REACT_APP_MAPQUEST_PROXY_URL||$.REACT_APP_MAPQUEST_PROXY_URL||`${E.API_BASE_URL}/mapquest-proxy`;E.GITHUB_TOKEN=T.VITE_GITHUB_TOKEN||T.REACT_APP_GITHUB_TOKEN||$.REACT_APP_GITHUB_TOKEN||"";E.GITHUB_REPO=T.VITE_GITHUB_REPO||T.REACT_APP_GITHUB_REPO||$.REACT_APP_GITHUB_REPO||"eldin007b/gls-scraper";E.WORKFLOW_FILE=T.VITE_WORKFLOW_FILE||T.REACT_APP_WORKFLOW_FILE||$.REACT_APP_WORKFLOW_FILE||"scraper.yml";E.ROUTE_STRATEGY=T.VITE_ROUTE_STRATEGY||T.REACT_APP_ROUTE_STRATEGY||$.REACT_APP_ROUTE_STRATEGY||"";E.VORANACHB_URL=T.VITE_VORANACHB_URL||T.REACT_APP_VORANACHB_URL||$.REACT_APP_VORANACHB_URL||"";async function ct(r){const t={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:14289510,y:46624050,acc:16.185}},formatted:!1,ext:"VAO.22",svcReqL:[{meth:"LocMatch",req:{input:{field:"S",loc:{type:"ALL",dist:1e3,name:r},maxLoc:7}},id:"1|43|"}]};try{const o=await fetch(`${E.API_BASE_URL}/vor-proxy`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});console.debug("[AddressSearchService] vor-proxy status:",o.status);try{const a=await o.text();return console.debug("[AddressSearchService] vor-proxy response (preview):",a.slice(0,1e3)),(a?JSON.parse(a):null)?.svcResL?.[0]?.res?.match?.locL||[]}catch(a){console.warn("[AddressSearchService] Failed to parse vor-proxy response as JSON",a)}}catch(o){console.warn("VAO proxy failed, falling back to Nominatim",o)}try{const o=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(r)}&format=json&addressdetails=1&limit=8&accept-language=de`,a=await fetch(o,{headers:{"User-Agent":"bde-evidencija/1.0 (+https://eldin007b.github.io/bde-evidencija)"}});return a.ok?(await a.json()).map(l=>({name:l.display_name,nameFormatted:{text:l.display_name},crd:{x:Math.round(l.lon*1e6),y:Math.round(l.lat*1e6)}})):[]}catch(o){return console.warn("Nominatim fallback failed",o),[]}}function Ge(r){if(r.info.statuscode!==0){const n={400:"Bad request",401:"Unauthorized - check API key",403:"Forbidden",500:"MapQuest server error"};throw new Error(`MapQuest API error ${r.info.statuscode}: ${n[r.info.statuscode]||r.info.messages?.join(", ")||"Unknown error"}`)}const t=r.route;if(!t)throw new Error("No route data received from MapQuest");const o=Math.round(t.distance*1e3),a=Math.round(t.time);return{distanceMeters:o,distanceText:pt(o),durationSeconds:a,durationText:gt(a),mapQuestData:{fuelUsed:t.fuelUsed,realTime:t.hasRealTime,sessionId:t.sessionId}}}async function dt(r,t,o,a){return await ut(r,t,o,a)}async function ut(r,t,o,a){if(E.MAPQUEST_PROXY_URL)try{return await ht(r,t,o,a)}catch{}try{return await mt(r,t,o,a)}catch(n){throw new Error(`Both MapQuest methods failed. Proxy: ${proxyError?.message||"not available"}, Direct: ${n.message}`)}}async function ht(r,t,o,a){try{const n={locations:[{latLng:{lat:r,lng:t}},{latLng:{lat:o,lng:a}}],options:{routeType:"fastest",unit:"k",doReverseGeocode:!1,enhancesNarratives:!1,avoidTimedConditions:!1}},l=E.MAPQUEST_PROXY_URL||`${E.API_BASE_URL}/mapquest-proxy`,g=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!g.ok)throw new Error(`MapQuest proxy error: ${g.status} - ${g.statusText}`);const h=await g.json();return Ge(h)}catch(n){throw n}}async function mt(r,t,o,a){const n=E.MAPQUEST_API_KEY;if(!n||n==="your_mapquest_key_here")throw new Error("MapQuest API key not configured");try{const l=`https://www.mapquestapi.com/directions/v2/route?key=${encodeURIComponent(n)}`,h=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locations:[{latLng:{lat:r,lng:t}},{latLng:{lat:o,lng:a}}],options:{routeType:"fastest",unit:"k",doReverseGeocode:!1,enhancesNarratives:!1,avoidTimedConditions:!1}})});if(!h.ok)throw new Error(`MapQuest API error: ${h.status} - ${h.statusText}`);const y=await h.json();return Ge(y)}catch(l){throw l}}function pt(r){if(r==null)return null;if(r>=1e3){const t=r/1e3;return new Intl.NumberFormat("de-DE",{maximumFractionDigits:1}).format(t)+" km"}return`${r} m`}function gt(r){if(r==null)return null;const t=Math.round(r/60);if(t>=60){const o=Math.floor(t/60),a=t%60;return a>0?`${o}h ${a}min`:`${o}h`}return`${t} min`}function X(r){if(r==null)return null;if(r>=1e3){const t=r/1e3;return new Intl.NumberFormat("de-DE",{maximumFractionDigits:1}).format(t)+" km"}return`${r} m`}function ee(r){if(r==null)return null;const t=Math.round(r/60);if(t>=60){const o=Math.floor(t/60),a=t%60;return a>0?`${o}h ${a}min`:`${o}h`}return`${t} min`}async function Oe(r,t,o,a){try{const n=await dt(r,t,o,a);return n?{...n,source:"mapquest"}:{distanceMeters:null,distanceText:null,durationSeconds:null,durationText:null,source:"none"}}catch(n){return console.warn("MapQuest routing failed:",n?.message||n),{distanceMeters:null,distanceText:null,durationSeconds:null,durationText:null,source:"none",error:n?.message||String(n)}}}class xt{constructor(){this.isAppVisible=!0,this.listeners=new Set,this.lastActivity=Date.now(),this.activityTimeout=null,this.gpsConfig={foreground:{enableHighAccuracy:!0,maximumAge:1e3,timeout:5e3,updateInterval:1e3},background:{enableHighAccuracy:!1,maximumAge:1e4,timeout:3e4,updateInterval:3e4},inactive:{enableHighAccuracy:!1,maximumAge:6e4,timeout:6e4,updateInterval:12e4}},this.currentMode="foreground",this.init()}init(){document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),window.addEventListener("focus",this.handleFocus.bind(this)),window.addEventListener("blur",this.handleBlur.bind(this)),this.trackUserActivity(),console.log("üîã [Battery] Service inicijalizovan")}handleVisibilityChange(){this.isAppVisible=!document.hidden,this.updateMode(),console.log("üîã [Battery] Visibility changed:",this.isAppVisible?"visible":"hidden")}handleFocus(){this.isAppVisible=!0,this.updateActivity(),this.updateMode(),console.log("üîã [Battery] App focused")}handleBlur(){this.isAppVisible=!1,this.updateMode(),console.log("üîã [Battery] App blurred")}trackUserActivity(){const t=["mousedown","mousemove","keypress","scroll","touchstart","click"],o=()=>{this.updateActivity()};t.forEach(a=>{document.addEventListener(a,o,{passive:!0})})}updateActivity(){this.lastActivity=Date.now(),this.activityTimeout&&clearTimeout(this.activityTimeout),this.activityTimeout=setTimeout(()=>{this.updateMode()},300*1e3),this.updateMode()}updateMode(){const a=Date.now()-this.lastActivity>300*1e3;let n;if(this.isAppVisible?a?n="inactive":n="foreground":n="background",n!==this.currentMode){const l=this.currentMode;this.currentMode=n,console.log(`üîã [Battery] Mode changed: ${l} ‚Üí ${n}`),this.notifyListeners({type:"mode_changed",oldMode:l,newMode:n,config:this.getCurrentConfig()})}}getCurrentConfig(){return this.gpsConfig[this.currentMode]}getCurrentMode(){return this.currentMode}addListener(t){return this.listeners.add(t),()=>this.listeners.delete(t)}removeListener(t){this.listeners.delete(t)}notifyListeners(t){this.listeners.forEach(o=>{try{o(t)}catch(a){console.error("üîã [Battery] Error in listener:",a)}})}async getBatteryInfo(){if("getBattery"in navigator)try{const t=await navigator.getBattery();return{level:Math.round(t.level*100),charging:t.charging,chargingTime:t.chargingTime,dischargingTime:t.dischargingTime}}catch(t){console.warn("üîã [Battery] Battery API not available:",t)}return null}async getAdaptiveGpsConfig(){const t=await this.getBatteryInfo(),o=this.getCurrentConfig();return t&&t.level<20&&!t.charging?{...o,enableHighAccuracy:!1,maximumAge:6e4,updateInterval:Math.max(o.updateInterval*2,6e4)}:t&&t.level<50&&!t.charging?{...o,maximumAge:Math.max(o.maximumAge*1.5,5e3),updateInterval:Math.max(o.updateInterval*1.5,5e3)}:o}destroy(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("focus",this.handleFocus),window.removeEventListener("blur",this.handleBlur),this.activityTimeout&&clearTimeout(this.activityTimeout),this.listeners.clear(),console.log("üîã [Battery] Service destroyed")}}const J=new xt;function ft(){const[r,t]=u.useState(J.getCurrentMode()),[o,a]=u.useState(J.getCurrentConfig()),[n,l]=u.useState(null);return u.useEffect(()=>{const h=i=>{i.type==="mode_changed"&&(t(i.newMode),a(i.config))},y=J.addListener(h);return J.getBatteryInfo().then(l),y},[]),{mode:r,config:o,batteryInfo:n,getAdaptiveConfig:async()=>await J.getAdaptiveGpsConfig(),isBackground:r==="background",isInactive:r==="inactive",isForeground:r==="foreground"}}function vt(r,t,o,a){const l=(o-r)*Math.PI/180,g=(a-t)*Math.PI/180,h=Math.sin(l/2)*Math.sin(l/2)+Math.cos(r*Math.PI/180)*Math.cos(o*Math.PI/180)*Math.sin(g/2)*Math.sin(g/2);return 6371*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}class bt{constructor(){this.debounceDelay=2e3,this.minDistanceThreshold=.05,this.speedAdaptiveThresholds={walking:{speed:5,distance:.02,delay:1500},cycling:{speed:20,distance:.05,delay:2e3},driving:{speed:50,distance:.1,delay:3e3},highway:{speed:80,distance:.2,delay:4e3}},this.cache=new Map,this.maxCacheSize=100,this.cacheExpirationTime=600*1e3,this.lastPosition=null,this.lastGeocodingTime=0,this.pendingTimeout=null,this.currentSpeed=0,this.listeners=new Set,console.log("üåç [ReverseGeo] Service inicijalizovan")}async reverseGeocode(t,o,a=0,n=!1){this.currentSpeed=a;const l=Date.now(),g={lat:t,lon:o},h=this.generateCacheKey(t,o);if(!n){const i=this.getCached(h);if(i)return console.log("üåç [ReverseGeo] Served from cache:",h),this.notifyListeners({type:"result",data:i.data,source:"cache",position:g}),i.data}const y=this.getSpeedBasedThresholds(a);if(!n&&this.lastPosition){const i=vt(this.lastPosition.lat,this.lastPosition.lon,t,o);if(i<y.distance)return console.log(`üåç [ReverseGeo] Skipped - insufficient movement: ${(i*1e3).toFixed(0)}m < ${(y.distance*1e3).toFixed(0)}m`),null}return!n&&l-this.lastGeocodingTime<y.delay?(console.log(`üåç [ReverseGeo] Skipped - too soon: ${l-this.lastGeocodingTime}ms < ${y.delay}ms`),this.scheduleDelayedGeocoding(t,o,a,y.delay),null):(this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=null),await this.performGeocoding(t,o,g,h))}scheduleDelayedGeocoding(t,o,a,n){this.pendingTimeout&&clearTimeout(this.pendingTimeout),this.pendingTimeout=setTimeout(async()=>{console.log("üåç [ReverseGeo] Executing delayed geocoding"),await this.reverseGeocode(t,o,a,!0),this.pendingTimeout=null},n)}async performGeocoding(t,o,a,n){try{this.notifyListeners({type:"started",position:a});const l=await this.callReverseGeocodingAPI(t,o);return l&&(l.address||l.city)?(this.setCached(n,l),this.lastPosition=a,this.lastGeocodingTime=Date.now(),console.log(`üåç [ReverseGeo] Success for ${t.toFixed(4)}, ${o.toFixed(4)}:`,l),this.notifyListeners({type:"result",data:l,source:"api",position:a}),l):(console.warn("üåç [ReverseGeo] No valid result received"),null)}catch(l){return console.error("üåç [ReverseGeo] Error:",l),this.notifyListeners({type:"error",error:l.message,position:a}),null}finally{this.notifyListeners({type:"finished",position:a})}}getSpeedBasedThresholds(t){const o=(t||0)*3.6;return o<this.speedAdaptiveThresholds.walking.speed?this.speedAdaptiveThresholds.walking:o<this.speedAdaptiveThresholds.cycling.speed?this.speedAdaptiveThresholds.cycling:o<this.speedAdaptiveThresholds.driving.speed?this.speedAdaptiveThresholds.driving:this.speedAdaptiveThresholds.highway}generateCacheKey(t,o){return`${t.toFixed(3)},${o.toFixed(3)}`}getCached(t){const o=this.cache.get(t);if(o){const a=Date.now();if(a-o.timestamp<this.cacheExpirationTime)return o.lastAccessed=a,o;this.cache.delete(t)}return null}setCached(t,o){const a=Date.now();this.cache.size>=this.maxCacheSize&&this.cleanupCache(),this.cache.set(t,{data:o,timestamp:a,lastAccessed:a})}cleanupCache(){const t=Array.from(this.cache.entries());t.sort((a,n)=>a[1].lastAccessed-n[1].lastAccessed);const o=Math.floor(t.length*.25);for(let a=0;a<o;a++)this.cache.delete(t[a][0]);console.log(`üåç [ReverseGeo] Cache cleanup: removed ${o} entries`)}async callReverseGeocodingAPI(t,o){try{const a=Math.round(o*1e6),n=Math.round(t*1e6),l=`${E.API_BASE_URL}/vor-proxy`,g={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:a,y:n,acc:20}},formatted:!1,ext:"VAO.22",svcReqL:[]},h={...g,svcReqL:[{meth:"LocGeoPos",req:{ring:{cCrd:{x:a,y:n},minDist:0,maxDist:30},locL:[{type:"S",mode:["foot","bike","car"]},{type:"P"},{type:"A"}],maxLoc:1,getPOIs:!1,getStops:!1}}]},y=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(y.ok){const b=await y.json();if(b?.svcResL?.[0]?.res?.locL?.[0]){const m=b.svcResL[0].res.locL[0];if(m.name){const A=m.name.split(","),_=A[0]?.trim()||"";let L="";return A.length>1&&(L=A.slice(1).join(",").trim()),{address:_,city:L}}}}const i={...g,svcReqL:[{meth:"LocMatch",req:{input:{loc:{name:"",crd:{x:a,y:n},type:"C"},field:"S"}}}]},x=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(x.ok){const b=await x.json();if(b?.svcResL?.[0]?.res?.match?.locL?.[0]){const m=b.svcResL[0].res.match.locL[0];if(m.name){const A=m.name.split(","),_=A[0]?.trim()||"";let L="";return A.length>1&&(L=A.slice(1).join(",").trim()),{address:_,city:L}}}}return{address:"",city:""}}catch(a){console.error("üåç [ReverseGeo] VAO API Error:",a);try{console.log("üåç [ReverseGeo] Trying Nominatim fallback...");const n=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${o}&accept-language=de,en&addressdetails=1`);if(n.ok){const l=await n.json();if(console.log("üåç [ReverseGeo] Nominatim fallback response:",l),l.display_name){let g=l.display_name;if(l.address){const h=l.address;let y="";h.house_number&&h.road?y=`${h.road} ${h.house_number}`:h.road?y=h.road:h.suburb&&(y=h.suburb);let i="";return h.postcode&&h.city?i=`${h.postcode} ${h.city}`:h.city?i=h.city:h.town?i=h.town:h.village&&(i=h.village),{address:y||g.split(",")[0],city:i||""}}return{address:g.split(",")[0]||"",city:g.split(",")[1]?.trim()||""}}}}catch(n){console.error("üåç [ReverseGeo] Nominatim fallback also failed:",n)}return{address:`${t.toFixed(6)}, ${o.toFixed(6)}`,city:"Koordinaten"}}}addListener(t){return this.listeners.add(t),()=>this.listeners.delete(t)}removeListener(t){this.listeners.delete(t)}notifyListeners(t){this.listeners.forEach(o=>{try{o(t)}catch(a){console.error("üåç [ReverseGeo] Listener error:",a)}})}getStats(){return{cacheSize:this.cache.size,maxCacheSize:this.maxCacheSize,lastPosition:this.lastPosition,lastGeocodingTime:this.lastGeocodingTime,currentSpeed:this.currentSpeed,currentThresholds:this.getSpeedBasedThresholds(this.currentSpeed),isPending:!!this.pendingTimeout}}clearCache(){this.cache.clear(),console.log("üåç [ReverseGeo] Cache cleared")}setThresholds(t){Object.assign(this.speedAdaptiveThresholds,t),console.log("üåç [ReverseGeo] Custom thresholds applied:",t)}destroy(){this.pendingTimeout&&clearTimeout(this.pendingTimeout),this.cache.clear(),this.listeners.clear(),console.log("üåç [ReverseGeo] Service destroyed")}}const W=new bt;function wt(){const[r,t]=u.useState(!1),[o,a]=u.useState(null),[n,l]=u.useState(null),[g,h]=u.useState(null);u.useEffect(()=>{const b=A=>{switch(A.type){case"started":t(!0),l(null);break;case"result":a(A.data),t(!1);break;case"error":l(A.error),t(!1);break;case"finished":t(!1);break}},m=W.addListener(b);return h(W.getStats()),m},[]);const y=async(b,m,A,_=!1)=>await W.reverseGeocode(b,m,A,_),i=()=>{h(W.getStats())};return{isLoading:r,lastResult:o,error:n,stats:g,reverseGeocode:y,refreshStats:i,clearCache:()=>{W.clearCache(),i()},service:W}}const yt=({children:r,className:t="",style:o,title:a="Mapa dostave - Austrija",loading:n=!1,address:l="",city:g="",onNavigate:h,onSearchSelect:y,mapRef:i,onLocateMe:x,autoLocate:b=!0,selectedMarker:m=null,footerRef:A,isMobile:_=typeof window<"u"?window.innerWidth<768:!1,sidebarLayout:L=!1,headerHeight:te=80,onMapClickCloseSidebar:I,alwaysShowSearchInterface:k=!1,hideSearchAndInfo:j=!1})=>{const[d,B]=u.useState(null),[R,V]=u.useState(""),[C,se]=u.useState(""),[q,Z]=u.useState([]),[v,ie]=u.useState(null),[N,le]=u.useState(!1),[U,D]=u.useState(!1),[re,fe]=u.useState(!1),[H,ve]=u.useState(null),[De,be]=u.useState(!1),[ce,Rt]=u.useState(null),[F,we]=u.useState(0),[ye,je]=u.useState(0),[He,Ne]=u.useState(!1),[oe,Ae]=u.useState(!1),[de,qe]=u.useState({top:0,left:0,width:0}),{mode:ue,getAdaptiveConfig:Ke}=ft(),{reverseGeocode:Ye,service:_e}=wt(),z=u.useRef(null),he=u.useRef(null),G=u.useRef(null);u.useRef(!1);const me=typeof window<"u"&&("ontouchstart"in window||navigator.maxTouchPoints>0),Se=typeof window<"u"&&window.innerWidth>=1024,pe=()=>{if(z.current&&_){const s=z.current.getBoundingClientRect();qe({top:s.bottom+window.scrollY+8,left:s.left+window.scrollX,width:s.width})}},We=(s,p,c,w)=>{const f=(c-s)*Math.PI/180,P=(w-p)*Math.PI/180,M=Math.sin(f/2)*Math.sin(f/2)+Math.cos(s*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(P/2)*Math.sin(P/2);return 6371*(2*Math.atan2(Math.sqrt(M),Math.sqrt(1-M)))},Ze=(s,p=50)=>{if(!s||s<=0)return null;const c=s/1e3/p;return Math.round(c*3600)},Te=()=>{i?.current?.zoomIn&&i.current.zoomIn()},Pe=()=>{i?.current?.zoomOut&&i.current.zoomOut()},Ee=()=>{if(console.log("üìç Lociraj me kliknuto - tra≈æim GPS lokaciju"),!navigator.geolocation){alert("Geolokacija nije podr≈æana u ovom pregledniku.");return}navigator.geolocation.getCurrentPosition(s=>{console.log("üìç GPS lokacija pronaƒëena:",s.coords);const p=[s.coords.latitude,s.coords.longitude];B({lat:s.coords.latitude,lon:s.coords.longitude});try{i?.current?.setView&&i.current.setView(p,17)}catch(c){console.warn("Map setView not available",c)}x&&x(p)},s=>{console.error("üìç GPS gre≈°ka:",s),alert("Nije moguƒáe dobiti lokaciju. Provjerite dozvole preglednika.")},{enableHighAccuracy:!0,maximumAge:5e3,timeout:15e3})},Qe=async(s,p)=>{Ne(!0);try{console.log("üîÑ Starting reverse geocoding for:",s,p);try{const c=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s}&lon=${p}&accept-language=de,en&addressdetails=1`);if(c.ok){const w=await c.json();if(console.log("üîÑ Nominatim response:",w),w.display_name){let S=w.display_name;if(w.address){const f=w.address;let P="";f.house_number&&f.road?P=`${f.road} ${f.house_number}`:f.road&&(P=f.road),f.postcode&&f.city?P+=P?`, ${f.postcode} ${f.city}`:`${f.postcode} ${f.city}`:f.city&&(P+=P?`, ${f.city}`:f.city),P&&(S=P)}V(String(S)),console.log("üìç Address found via Nominatim:",S);return}}}catch(c){console.warn("üîÑ Nominatim failed:",c)}try{const c={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:Math.round(p*1e6),y:Math.round(s*1e6),acc:16.185}},formatted:!1,ext:"VAO.22",svcReqL:[{meth:"LocMatch",req:{input:{field:"S",loc:{type:"ALL",crd:{x:Math.round(p*1e6),y:Math.round(s*1e6)},dist:500},maxLoc:3}},id:"1|43|"}]},w=await fetch(`${E.API_BASE_URL}/vor-proxy`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});console.debug("[MapCardModern] vor-proxy status:",w.status);try{const S=await w.text();console.debug("[MapCardModern] vor-proxy response (preview):",S?S.slice(0,1e3):"");const f=S?JSON.parse(S):null;if(console.log("üîÑ VAO response:",f),f&&Array.isArray(f.svcResL)&&f.svcResL[0]&&f.svcResL[0].res&&f.svcResL[0].res.match&&Array.isArray(f.svcResL[0].res.match.locL)){const P=f.svcResL[0].res.match.locL;if(P.length>0){const M=P[0];let O="";if(M.nameFormatted&&M.nameFormatted.text?O=M.nameFormatted.text.replace(/<[^>]*>/g,""):M.name&&(O=M.name),O){V(String(O)),console.log("üìç Address found via VAO:",O);return}}}}catch(S){console.warn("üîÑ VAO fallback failed (parse/response):",S)}}catch(c){console.warn("üîÑ VAO proxy request failed:",c)}console.log("üìç Using coordinates as final fallback"),V(`${s.toFixed(6)}, ${p.toFixed(6)}`)}catch(c){console.error("üîÑ Reverse geocoding error:",c),V(`${s.toFixed(6)}, ${p.toFixed(6)}`)}finally{Ne(!1)}},Re=()=>{if(N)document.exitFullscreen&&document.exitFullscreen().then(()=>{le(!1)});else{const s=he.current;s?.requestFullscreen&&s.requestFullscreen().then(()=>{le(!0),me&&setTimeout(()=>{i?.current?.setView&&d&&i.current.setView([d.lat,d.lon],17)},100)})}};u.useEffect(()=>((async()=>{if(navigator.geolocation){G.current&&(navigator.geolocation.clearWatch(G.current),G.current=null);try{const p=await Ke();console.log(`üîã [GPS] Starting tracking in ${ue} mode:`,p);const c=navigator.geolocation.watchPosition(w=>{const S={lat:w.coords.latitude,lon:w.coords.longitude};if(B(S),we(w.coords.speed||0),je(w.coords.heading||0),N&&i?.current?.setView){const f=i?.current?.getZoom?i.current.getZoom():void 0;i.current.setView([S.lat,S.lon],f)}},w=>{console.error(`üîã [GPS] Tracking error in ${ue} mode:`,w)},p);G.current=c}catch(p){console.error("üîã [GPS] Failed to start adaptive tracking:",p);const c=navigator.geolocation.watchPosition(w=>{const S={lat:w.coords.latitude,lon:w.coords.longitude};if(B(S),we(w.coords.speed||0),je(w.coords.heading||0),N&&i?.current?.setView){const f=i?.current?.getZoom?i.current.getZoom():void 0;i.current.setView([S.lat,S.lon],f)}},w=>console.error("GPS tracking error:",w),{enableHighAccuracy:!0,maximumAge:1e3,timeout:5e3});G.current=c}}})(),()=>{G.current&&navigator.geolocation?.clearWatch&&(navigator.geolocation.clearWatch(G.current),G.current=null)}),[ue,N]),u.useEffect(()=>{const s=()=>{le(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",s),()=>document.removeEventListener("fullscreenchange",s)},[]),u.useEffect(()=>{d&&d.lat&&d.lon&&(console.log("üìç Coordinates changed, starting debounced reverse geocoding:",d),Ye(d.lat,d.lon,F))},[d,F]),u.useEffect(()=>{const s=c=>{if(c.type==="result"&&c.data){const w=`${c.data.address}${c.data.city?", "+c.data.city:""}`;V(w),console.log("üìç Address updated from debounced service:",w)}else c.type==="error"&&d&&(console.warn("üìç Debounced reverse geocoding failed, falling back to local service:",c.error),Qe(d.lat,d.lon))};return _e.addListener(s)},[_e,d]),u.useEffect(()=>{let s=!1;(async()=>{if(!(!d||!v||!v.lat||!v.lon))try{be(!0),console.log("üó∫Ô∏è Computing route from",d,"to",v);const c=await Oe(d.lat,d.lon,v.lat,v.lon);if(s)return;ve(c||null)}catch(c){console.warn("üó∫Ô∏è Route computation failed:",c?.message||c),s||ve(null)}finally{s||be(!1)}})();try{window.__triggerRoute=async()=>{if(!d||!v){console.warn("window.__triggerRoute: missing currentCoords or selectedLocation",{currentCoords:d,selectedLocation:v});return}console.log("window.__triggerRoute: invoking getDrivingRouteInfo",{currentCoords:d,selectedLocation:v});try{const c=await Oe(d.lat,d.lon,v.lat,v.lon);return console.log("window.__triggerRoute result",c),c}catch(c){throw console.error("window.__triggerRoute error",c),c}}}catch{}return()=>{s=!0}},[d,v]),u.useEffect(()=>{b&&!d&&navigator.geolocation&&(console.log("üöÄ Auto-locating on component mount"),navigator.geolocation.getCurrentPosition(s=>{console.log("üìç Auto-locate GPS found:",s.coords),B({lat:s.coords.latitude,lon:s.coords.longitude});try{i?.current?.setView&&i.current.setView([s.coords.latitude,s.coords.longitude],15)}catch(p){console.warn("Map setView not available",p)}},s=>{console.warn("üìç Auto-locate failed:",s)},{enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}))},[b,d,i]),u.useEffect(()=>{if(console.log("üìç Props changed - address:",l,"city:",g,"selectedMarker:",m),l||g||m){console.log("üìç Setting location from props:",{address:l,city:g,selectedMarker:m});let s=null,p=null;m&&(m.lat!==void 0&&m.lon!==void 0?(s=m.lat,p=m.lon):m.lat!==void 0&&m.lng!==void 0&&(s=m.lat,p=m.lng));const c={address:l||"",city:g||"",lat:s,lon:p};if(c.address||c.city||c.lat&&c.lon){ie(c),console.log("üéØ Selected location set from external props:",c);const w=(l||"")+(g?`, ${g}`:"");w.trim()&&se(w.trim())}}else console.log("üìç Clearing selected location - no data"),ie(null),se("")},[l,g,m]),u.useEffect(()=>{const s=()=>{U&&_&&pe()};return window.addEventListener("scroll",s),window.addEventListener("resize",s),()=>{window.removeEventListener("scroll",s),window.removeEventListener("resize",s)}},[U,_]);const Je=async s=>{if(!s||s.length<3){Z([]);return}fe(!0);try{const p=await ct(s);Z(p||[])}catch(p){console.error("Gre≈°ka pri pretra≈æivanju:",p),Z([])}finally{fe(!1)}},ge=s=>{const p=s.target.value;if(se(p),oe){Ae(!1);return}p.length>=3?Je(p):Z([])},Me=s=>{console.log("üéØ Suggestion clicked:",s);const p=s.crd?.x,c=s.crd?.y;if(typeof p=="number"&&typeof c=="number"&&i?.current?.setView){const w=c/1e6,S=p/1e6;i.current.setView([w,S],17);let f=s.nameFormatted?.text||s.name||"",P=f,M="";const O=/<br\s*\/?.*?>/i;if(O.test(f)){const Q=f.split(O);P=Q[0].trim(),M=Q.slice(1).join(" ").trim()}else if(f.includes(",")){const Q=f.split(",");P=Q[0].trim(),M=Q.slice(1).join(",").trim()}const Le=P+(M?`, ${M}`:"");se(Le);const xe={address:P,city:M,lat:w,lon:S,data:{nameFormatted:{text:f},name:P},label:Le};ie(xe),console.log("üéØ Selected location set:",xe),y&&y(xe),Z([]),Ae(!0),D(!1),z.current&&z.current.blur()}},ke=()=>{C.trim()&&h&&h(C.trim())},Ce=N?{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:9999}:{};return e.jsxs("div",{className:`relative ${t} ${N?"fixed inset-0 z-[9999]":""}`,style:o,children:[Se&&!N?e.jsxs("div",{className:"flex h-screen bg-gradient-to-br from-slate-100 via-white to-blue-50",children:[e.jsx("div",{className:"w-1/2 bg-gradient-to-b from-white via-slate-50 to-blue-50 border-r border-slate-200/50 flex flex-col backdrop-blur-sm",children:e.jsxs("div",{className:"p-6 flex flex-col gap-6 h-full overflow-y-auto",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"Navigacija"}),e.jsx("p",{className:"text-slate-600",children:"Pronaƒëi rutu do odredi≈°ta"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{ref:z,type:"text",value:C,onChange:ge,onFocus:()=>D(!0),onBlur:()=>{setTimeout(()=>{oe||D(!1)},200)},className:"w-full px-4 py-3 rounded-2xl border border-slate-300 bg-white/80 backdrop-blur-sm shadow-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all duration-200 placeholder-slate-500",placeholder:"Unesi adresu za navigaciju...",autoComplete:"off"}),U&&(q.length>0||re)&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white/95 backdrop-blur-sm border border-slate-200 rounded-2xl shadow-2xl max-h-60 overflow-y-auto z-[3000]",children:re?e.jsxs("div",{className:"p-4 flex items-center gap-3 text-slate-600",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),"Tra≈æim adrese..."]}):q.length===0?e.jsxs("div",{className:"p-4 text-slate-600",children:['Nema rezultata za "',C,'"']}):q.map((s,p)=>e.jsx("div",{className:"p-4 hover:bg-blue-50/50 cursor-pointer border-b border-slate-100 last:border-b-0 transition-colors duration-150",onClick:()=>Me(s),onMouseDown:c=>c.preventDefault(),children:e.jsx("div",{className:"font-medium text-slate-800",children:s.nameFormatted?.text?.replace(/<[^>]*>/g,"")||s.name||""})},p))})]}),e.jsx("button",{className:"px-6 py-3 rounded-2xl bg-gradient-to-r from-blue-500 to-blue-600 text-white hover:from-blue-600 hover:to-blue-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95",onClick:ke,disabled:!C.trim(),title:"Otvori navigaciju",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"})})})]})})}),e.jsx("div",{className:"space-y-4 flex-1",children:v?e.jsx("div",{className:"p-4 rounded-2xl bg-gradient-to-br from-white/90 via-blue-50/30 to-purple-50/20 backdrop-blur-md border border-white/30 shadow-xl",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[R?e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-xl bg-gradient-to-r from-emerald-50/80 to-green-50/60 backdrop-blur-sm border border-emerald-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-emerald-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("span",{className:"text-sm font-medium text-slate-800 truncate",title:R,children:R})]}):d&&typeof d.lat=="number"&&typeof d.lon=="number"?e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-xl bg-gradient-to-r from-emerald-50/80 to-green-50/60 backdrop-blur-sm border border-emerald-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-emerald-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsxs("span",{className:"text-sm font-medium text-slate-800 truncate",title:`${d.lat.toFixed(6)}, ${d.lon.toFixed(6)}`,children:[d.lat.toFixed(6),", ",d.lon.toFixed(6)]})]}):e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-xl bg-gradient-to-r from-gray-50/80 to-slate-50/60 backdrop-blur-sm border border-gray-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("span",{className:"text-sm font-medium text-slate-600 truncate",children:"Moja lokacija nije dostupna"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-xl bg-gradient-to-r from-rose-50/80 to-red-50/60 backdrop-blur-sm border border-rose-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-rose-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("circle",{cx:"12",cy:"12",r:"6"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),e.jsx("span",{className:"text-sm font-medium text-slate-800 truncate",title:`${v.address}${v.city?`, ${v.city}`:""}`,children:`${String(v.address)}${v.city?`, ${String(v.city)}`:""}`})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"text-right bg-gradient-to-br from-blue-50/50 to-indigo-50/30 backdrop-blur-sm border border-blue-200/30 rounded-xl px-4 py-3",children:e.jsxs("div",{className:"text-base font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:[ce&&typeof ce.compact=="string"?ce.compact:H?e.jsxs(e.Fragment,{children:[H.durationText||ee(H.durationSeconds)||"--"," ‚Ä¢ ",H.distanceText||X(H.distanceMeters)||"--"]}):d&&v?(()=>{const s=We(d.lat,d.lon,v.lat,v.lon),p=Math.round(s*1e3),c=Ze(p,40);return c?`${ee(c)} ‚Ä¢ ${X(p)}`:"--"})():"--",De&&e.jsx("span",{className:"ml-2",children:e.jsx("div",{className:"w-3 h-3 border border-blue-500 border-t-transparent rounded-full animate-spin inline-block"})})]})})})]})}):e.jsxs(e.Fragment,{children:[He?e.jsx("div",{className:"p-4 rounded-2xl bg-white/80 backdrop-blur-sm border border-slate-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"üìç"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-slate-600 font-medium",children:"Prepoznajem adresu..."})]})]})}):R?e.jsx("div",{className:"p-4 rounded-2xl bg-white/80 backdrop-blur-sm border border-slate-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ÔøΩ"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-1",children:"Moja lokacija"}),e.jsx("p",{className:"text-sm text-slate-600",children:R})]})]})}):d&&typeof d.lat=="number"&&typeof d.lon=="number"?e.jsx("div",{className:"p-4 rounded-2xl bg-white/70 backdrop-blur-sm border border-slate-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ÔøΩ"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-slate-800 mb-1",children:"Moja lokacija"}),e.jsxs("p",{className:"text-sm text-slate-600",children:[d.lat.toFixed(6),", ",d.lon.toFixed(6)]})]})]})}):e.jsx("div",{className:"p-4 rounded-2xl bg-white/60 backdrop-blur-sm border border-slate-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl opacity-60",children:"üìç"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-slate-700 mb-1",children:"Moja lokacija"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Lokacija nije dostupna"})]})]})}),v&&!R&&e.jsx("div",{className:"p-4 rounded-2xl bg-white/80 backdrop-blur-sm border border-slate-200/50 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"üéØ"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-1",children:"Odabrana adresa"}),e.jsx("p",{className:"text-sm text-gray-600",children:`${String(v.address)}${v.city?`, ${String(v.city)}`:""}`})]})]})}),C&&!v&&e.jsx("div",{className:"p-3 rounded-lg bg-white border border-gray-200 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"üîç"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-1",children:"Pretra≈æivanje"}),e.jsx("p",{className:"text-sm text-gray-600",children:C})]})]})})]})})]})}),e.jsx("div",{className:"w-1/2 relative",children:e.jsx("div",{ref:he,className:"w-full h-full bg-gradient-to-br from-gray-100 via-gray-200 to-gray-300 overflow-hidden",style:Ce,children:n?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm z-20",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-6"}),e.jsx("p",{className:"text-slate-700 font-medium text-lg",children:"Uƒçitavam mapu..."})]}):e.jsxs(e.Fragment,{children:[Y.Children.map(r,s=>{if(Y.isValidElement(s)){const p=d?[d.lat,d.lon]:s.props.userLocation||null;return Y.cloneElement(s,{routeInfo:H||s.props.routeInfo||null,userLocation:p,selectedMarker:v||s.props.selectedMarker||null,speed:F||s.props.speed||0,heading:ye||s.props.heading||0,isFullscreen:N||s.props.isFullscreen||!1})}return s}),e.jsxs("div",{className:"absolute right-6 top-20 flex flex-col gap-3 z-30",children:[e.jsx("button",{className:"w-12 h-12 bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-blue-600 hover:bg-white group",onClick:Te,title:"Poveƒáaj zoom",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z"})})}),e.jsx("button",{className:"w-12 h-12 bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-blue-600 hover:bg-white group",onClick:Pe,title:"Smanji zoom",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M19 11H5v2h14z"})})}),e.jsx("button",{className:"w-12 h-12 bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-emerald-600 hover:bg-white group",onClick:Ee,title:"Lociraj me",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z"})})}),me&&e.jsx("button",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 text-white border border-purple-400/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center hover:from-purple-600 hover:to-purple-700 group",onClick:Re,title:N?"Izaƒëi iz punog ekrana":"Puni ekran",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:N?e.jsx("path",{d:"M18 7h-3V4h-2v3H10V4H8v3H5v2h3v3H5v2h3v3h2v-3h3v3h2v-3h3v-2h-3V9h3V7z"}):e.jsx("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})})})]}),e.jsx("div",{className:"absolute right-6 bottom-6 bg-white/95 backdrop-blur-sm border border-slate-300 rounded-2xl px-4 py-3 shadow-xl z-1000",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse bg-blue-500"}),e.jsx("span",{className:"font-bold text-lg text-slate-800",children:F?(F*3.6).toFixed(1):"0"}),e.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"km/h"})]})})]})})})]}):e.jsxs("div",{className:`relative ${N?"fixed inset-0":"min-h-[300px] h-full"} ${j&&_?"bg-white":"bg-gradient-to-br from-slate-100 via-white to-blue-50 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20"} overflow-hidden`,children:[(!j||!_)&&e.jsxs("div",{className:"relative bg-gradient-to-r from-blue-600 via-purple-600 to-blue-700 text-white p-6 backdrop-blur-sm",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsxs("div",{className:"relative z-10",children:[a&&e.jsx("h3",{className:"text-2xl font-bold mb-2 text-center",children:a}),!j&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("input",{ref:z,type:"text",value:C,onChange:ge,onFocus:()=>{D(!0),pe()},onBlur:()=>{setTimeout(()=>{oe||D(!1)},200)},className:"w-full px-4 py-3 rounded-2xl border border-white/30 bg-white/90 backdrop-blur-sm shadow-lg focus:ring-2 focus:ring-white focus:border-white outline-none transition-all duration-200 text-slate-800 placeholder-slate-500",placeholder:"Unesi adresu za navigaciju...",autoComplete:"off"})}),e.jsx("button",{className:"px-6 py-3 rounded-2xl bg-white/20 backdrop-blur-sm border border-white/30 text-white hover:bg-white/30 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg",onClick:ke,disabled:!C.trim(),title:"Otvori navigaciju",children:e.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"})})})]})]})]}),e.jsxs("div",{ref:he,className:"flex-1 relative min-h-[500px] h-full bg-gradient-to-br from-gray-100 via-gray-200 to-gray-300 w-full box-border overflow-hidden",style:Ce,children:[n?e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm z-20",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-6"}),e.jsx("p",{className:"text-slate-700 font-medium text-lg",children:"Uƒçitavam mapu..."})]}):e.jsxs(e.Fragment,{children:[Y.Children.map(r,s=>{if(Y.isValidElement(s)){const p=d?[d.lat,d.lon]:s.props.userLocation||null;return Y.cloneElement(s,{routeInfo:H||s.props.routeInfo||null,userLocation:p,selectedMarker:v||s.props.selectedMarker||null,speed:F||s.props.speed||0,heading:ye||s.props.heading||0,isFullscreen:N||s.props.isFullscreen||!1})}return s}),N&&R&&(()=>{const p=(c=>c?c.split(",")[0].trim().replace(/^(Adresa:|Address:|Lokacija:|Location:)/i,"").trim()||c:"")(R);return e.jsx("div",{className:"absolute left-0 right-0 top-4 z-40",children:e.jsx("div",{className:"mx-4 bg-white/95 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("span",{className:"text-lg",children:"üìç"}),e.jsx("p",{className:"text-base font-bold text-slate-800 truncate",children:p})]})})})})(),j&&_&&e.jsx("div",{className:"absolute left-6 top-20 flex flex-col gap-3 z-30",children:e.jsx("button",{className:"w-12 h-12 bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-blue-600 hover:bg-white group",onClick:()=>{D(!U),U||(pe(),setTimeout(()=>{z.current&&z.current.focus()},100))},title:"Pretra≈æi lokaciju",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",className:"group-hover:scale-110 transition-transform",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"M21 21l-4.35-4.35"})]})})}),j&&_&&U&&e.jsx("div",{className:"absolute left-20 top-6 right-6 z-40",children:e.jsx("div",{className:"h-12 bg-white/95 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl overflow-hidden",children:e.jsx("input",{ref:z,type:"text",value:C,onChange:ge,onBlur:()=>{setTimeout(()=>{oe||D(!1)},200)},className:"w-full h-full px-4 text-sm border-0 bg-transparent focus:ring-0 focus:outline-none text-slate-800 placeholder-slate-500",placeholder:"Unesi adresu za navigaciju...",autoComplete:"off"})})}),e.jsxs("div",{className:"absolute right-6 top-20 flex flex-col gap-3 z-30",children:[e.jsx("button",{className:`${N?"w-14 h-14":"w-12 h-12"} bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-blue-600 hover:bg-white group`,onClick:Te,title:"Poveƒáaj zoom",children:e.jsx("svg",{width:N?"26":"22",height:N?"26":"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z"})})}),e.jsx("button",{className:`${N?"w-14 h-14":"w-12 h-12"} bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-blue-600 hover:bg-white group`,onClick:Pe,title:"Smanji zoom",children:e.jsx("svg",{width:N?"26":"22",height:N?"26":"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M19 11H5v2h14z"})})}),e.jsx("button",{className:`${N?"w-14 h-14":"w-12 h-12"} bg-white/90 backdrop-blur-sm border border-slate-200/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center text-slate-700 hover:text-emerald-600 hover:bg-white group`,onClick:Ee,title:"Lociraj me",children:e.jsx("svg",{width:N?"26":"22",height:N?"26":"22",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z"})})}),me&&e.jsx("button",{className:`${N?"w-14 h-14":"w-12 h-12"} bg-gradient-to-br from-purple-500 to-purple-600 text-white border border-purple-400/50 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 flex items-center justify-center hover:from-purple-600 hover:to-purple-700 group`,onClick:Re,title:N?"Izaƒëi iz punog ekrana":"Puni ekran",children:e.jsx("svg",{width:N?"24":"20",height:N?"24":"20",viewBox:"0 0 24 24",fill:"currentColor",className:"group-hover:scale-110 transition-transform",children:N?e.jsx("path",{d:"M18 7h-3V4h-2v3H10V4H8v3H5v2h3v3H5v2h3v3h2v-3h3v3h2v-3h3v-2h-3V9h3V7z"}):e.jsx("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})})})]}),e.jsx("div",{className:"absolute right-6 bottom-6 bg-white/95 backdrop-blur-sm border border-slate-300 rounded-2xl px-4 py-3 shadow-xl z-1000",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse bg-blue-500"}),e.jsx("span",{className:"font-bold text-lg text-slate-800",children:F?(F*3.6).toFixed(1):"0"}),e.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"km/h"})]})})]}),!Se&&!j&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-white/95 via-white/90 to-transparent backdrop-blur-sm border-t border-white/20 p-4 space-y-2",children:[d?e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-gradient-to-r from-blue-50/80 to-indigo-50/60 backdrop-blur-sm border border-blue-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-blue-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsxs("span",{className:"text-xs font-medium text-slate-800 truncate",children:["Moja lokacija: ",d.lat.toFixed(4),", ",d.lon.toFixed(4)]})]}):e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-gradient-to-r from-gray-50/80 to-slate-50/60 backdrop-blur-sm border border-gray-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-gray-400 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("span",{className:"text-xs font-medium text-slate-600 truncate",children:"Moja lokacija nije dostupna"})]}),v&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-gradient-to-r from-rose-50/80 to-red-50/60 backdrop-blur-sm border border-rose-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-rose-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("circle",{cx:"12",cy:"12",r:"6"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),e.jsx("span",{className:"text-xs font-medium text-slate-800 truncate",title:`${v.address}${v.city?`, ${v.city}`:""}`,children:`${v.address}${v.city?`, ${v.city}`:""}`})]}),C&&!v&&e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-gradient-to-r from-amber-50/80 to-yellow-50/60 backdrop-blur-sm border border-amber-200/40",children:[e.jsxs("svg",{className:"w-4 h-4 text-amber-600 flex-shrink-0",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"M21 21l-4.35-4.35"})]}),e.jsxs("span",{className:"text-xs font-medium text-slate-800 truncate",children:["Pretra≈æivanje: ",C]})]})]})]}),L&&e.jsx("div",{className:"w-80 bg-gradient-to-b from-white via-slate-50 to-blue-50 border-l border-slate-200/50 flex flex-col backdrop-blur-sm",children:e.jsxs("div",{ref:A,className:"p-6 flex flex-col gap-4 h-full",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-800 mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"Informacije"]}),e.jsx("div",{className:"flex flex-col gap-4 flex-1"})]})})]}),_&&(!j&&U||j&&U)&&(q.length>0||re)&&et.createPortal(e.jsx("div",{className:"fixed bg-white/95 backdrop-blur-sm border border-slate-200 rounded-xl shadow-xl max-h-48 overflow-y-auto z-[99999]",style:{top:j?"calc(1.5rem + 48px + 8px)":de.top,left:j?"5rem":de.left,right:j?"1.5rem":"auto",width:j?"auto":de.width},children:re?e.jsxs("div",{className:"p-3 flex items-center gap-2 text-slate-600",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm",children:"Tra≈æim adrese..."})]}):q.length===0?e.jsxs("div",{className:"p-3 text-slate-600 text-sm",children:['Nema rezultata za "',C,'"']}):q.map((s,p)=>e.jsxs("div",{className:"p-3 hover:bg-blue-50/50 cursor-pointer border-b border-slate-100 last:border-b-0 transition-colors duration-150",onClick:()=>Me(s),onMouseDown:c=>c.preventDefault(),children:[e.jsx("div",{className:"font-medium text-slate-800 text-sm",children:s.nameFormatted?.text?.replace(/<[^>]*>/g,"")||s.name||""}),e.jsx("div",{className:"text-xs text-slate-600 mt-1",children:s.district||s.region||s.country||""})]},p))}),document.body)]})},jt=()=>{const r=st();return u.useEffect(()=>{setTimeout(()=>{r.invalidateSize()},200)},[r]),null};function Nt(r,t){const o=Math.round(t*1e6),a=Math.round(r*1e6);return{x:o,y:a}}const Ve=`${E.API_BASE_URL}/vor-proxy`,ae={id:"ibwmnqg8g2kj8iwg",ver:"1.59",lang:"deu",auth:{type:"AID",aid:"wf7mcf9bv3nv8g5f"},client:{id:"VAO",type:"WEB",name:"webapp",l:"vs_anachb",v:10010,pos:{x:14289513,y:46624058,acc:20}},formatted:!1,ext:"VAO.22",svcReqL:[]};function At({onAddressSelect:r}){const[t,o]=u.useState(null),[a,n]=u.useState(""),[l,g]=u.useState(null);if(u.useRef(null),$e({click:i=>{console.log("üó∫Ô∏è Map clicked at:",i.latlng),o(i.latlng),n("Uƒçitavanje adrese..."),g(null);const{x,y:b}=Nt(i.latlng.lat,i.latlng.lng);console.log("üìç Projected coordinates:",{x,y:b}),(async()=>{const m={...ae,client:{...ae.client,pos:{x,y:b,acc:20}},svcReqL:[{meth:"LocGeoPos",req:{ring:{cCrd:{x,y:b},minDist:0,maxDist:30},maxLoc:1,locFltrL:[{type:"PROD",mode:"INC",value:4087}],getPOIs:!0},id:"1|5|"}]};try{const _=await(await fetch(Ve,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).json();if(_&&_.svcResL&&_.svcResL.length>0&&_.svcResL[0].res&&_.svcResL[0].res.locL&&_.svcResL[0].res.locL.length>0){const k=_.svcResL[0].res.locL[0];let j=k.nameFormatted&&k.nameFormatted.text||k.name||k.txt||"";/^-?\d+\.\d+, ?-?\d+\.\d+$/.test(j)&&(j="Nema adrese za ovu lokaciju"),n(j||"Adresa pronaƒëena"),g({geoData:_,x,y:b});let d=j,B="";if(j&&j.includes(",")){const V=j.split(",");d=V[0].trim(),B=V.slice(1).join(",").trim()}const R={address:d,city:B,lat:i.latlng.lat,lon:i.latlng.lng};console.log("üéØ ClickToVORAddress calling onAddressSelect:",R),r&&r(R);return}const L={...ae,client:{...ae.client,pos:{x,y:b,acc:20}},svcReqL:[{meth:"LocMatch",req:{input:{field:"S",loc:{type:"C",crd:{x,y:b}},maxLoc:1,locFltrL:[{type:"META",value:"in_austria_test"}]}},id:"1|24|"}]},I=await(await fetch(Ve,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(L)})).json();if(g({matchData:I,x,y:b}),I&&I.svcResL&&I.svcResL.length>0&&I.svcResL[0].res&&I.svcResL[0].res.match&&I.svcResL[0].res.match.locL&&I.svcResL[0].res.match.locL.length>0){const k=I.svcResL[0].res.match.locL[0];let j=k.nameFormatted&&k.nameFormatted.text||k.name||k.txt||"";/^-?\d+\.\d+, ?-?\d+\.\d+$/.test(j)&&(j="Nema adrese za ovu lokaciju"),n(j||"Adresa pronaƒëena");let d=j,B="";if(j&&j.includes(",")){const R=j.split(",");d=R[0].trim(),B=R.slice(1).join(",").trim()}r&&r({address:d,city:B,lat:i.latlng.lat,lon:i.latlng.lng});return}n("Adresa nije pronaƒëena"),r&&r({address:"",city:"",lat:i.latlng.lat,lon:i.latlng.lng})}catch(A){n("Gre≈°ka pri dohvaƒáanju adrese: "+(A?.message||JSON.stringify(A))),g(A),r&&r({address:"",city:"",lat:i.latlng.lat,lon:i.latlng.lng})}})()},move:()=>{o(null),n(""),y(!1)}}),a&&a.includes(",")){const i=a.split(",");i[0].trim(),i.slice(1).join(",").trim()}t?.lat,t?.lng;const[h,y]=u.useState(!0);return $e({}),t?e.jsx(rt,{center:t,radius:7,pathOptions:{color:"#0ea5e9",fillColor:"#0ea5e9",fillOpacity:.92,weight:1.5}}):null}let _t=ne.divIcon({html:`<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z" fill="#ef4444" stroke="#dc2626" stroke-width="2"/>
    <circle cx="12" cy="10" r="3" fill="white"/>
  </svg>`,className:"custom-div-icon",iconSize:[24,24],iconAnchor:[12,24]});ne.Marker.prototype.options.icon=_t;function St({address:r,lat:t,lon:o,onClose:a,routeInfo:n,userLocation:l}){let g=r,h="";if(r&&r.includes(",")){const x=r.split(",");g=x[0].trim(),h=x.slice(1).join(",").trim()}const y=t&&o?`https://www.google.com/maps/search/?api=1&query=${t},${o}`:"#";let i=null;if(n&&n.distanceMeters&&n.durationSeconds){const x=n.durationText||ee(n.durationSeconds)||"--",b=n.distanceText||X(n.distanceMeters)||"--";i=`${x} ‚Ä¢ ${b}`}else if(n&&n.distance&&n.duration){const x=ee(n.duration)||"--",b=X(n.distance)||"--";i=`${x} ‚Ä¢ ${b}`}else if(l&&t&&o){const b=(t-l[0])*Math.PI/180,m=(o-l[1])*Math.PI/180,A=Math.sin(b/2)*Math.sin(b/2)+Math.cos(l[0]*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(m/2)*Math.sin(m/2),L=6371*(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A))),te=Math.round(L*1e3),k=te>0?Math.round(L/40*3600):null,j=k?ee(k):"--",d=X(te);i=`${j} ‚Ä¢ ${d}`}return e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-xl shadow-2xl p-4 min-w-[240px] max-w-[320px] border border-gray-100 relative z-50",onMouseDown:x=>x.stopPropagation(),onClick:x=>x.stopPropagation(),children:[e.jsx("button",{onClick:x=>{x.preventDefault(),x.stopPropagation(),a()},onMouseDown:x=>{x.preventDefault(),x.stopPropagation()},className:"absolute -top-2 -right-2 w-8 h-8 flex items-center justify-center bg-gray-800 text-white hover:bg-gray-900 rounded-full shadow-lg transition-all duration-200 hover:scale-105 z-50","aria-label":"Zatvori popup",title:"Zatvori",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-start gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-base font-semibold text-gray-900 leading-tight",children:g}),h&&e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:h})]})}),i&&e.jsx("div",{className:"flex items-center justify-center py-2 px-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-100",children:e.jsx("div",{className:"text-lg font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:i})}),e.jsx("button",{onClick:()=>window.open(y,"_blank"),className:"w-full py-3 px-4 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-[1.02] active:scale-[0.98]",children:"Pokreni navigaciju"})]})]})}function Tt({position:r,address:t,speed:o=0,heading:a=0,isFullscreen:n=!1}){if(!r)return null;const l=()=>o>1?ne.divIcon({html:`
          <div style="transform: rotate(${a}deg); width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
            <div style="width: 32px; height: 32px; background: #3b82f6; border: 4px solid white; border-radius: 50%; box-shadow: 0 4px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                <path d="M12 2l8 20-8-6-8 6 8-20z"/>
              </svg>
            </div>
          </div>
        `,className:"custom-location-marker",iconSize:[32,32],iconAnchor:[16,16]}):ne.divIcon({html:`
          <div style="width: 16px; height: 16px; background: #3b82f6; border: 2px solid white; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.3); animation: pulse 2s infinite;">
          </div>
          <style>
            @keyframes pulse {
              0% { opacity: 1; }
              50% { opacity: 0.5; }
              100% { opacity: 1; }
            }
          </style>
        `,className:"custom-location-marker-static",iconSize:[16,16],iconAnchor:[8,8]});return e.jsx(Ue,{position:r,icon:l(),children:e.jsx(Fe,{children:typeof t<"u"&&t?String(t):"Moja lokacija"})})}function Pt({marker:r,onAddressSelect:t,routeInfo:o,userLocation:a}){const n=u.useRef();if(u.useEffect(()=>{n.current&&r&&r.lat&&r.lon&&setTimeout(()=>{n.current.openPopup()},100)},[r?.lat,r?.lon]),!r||!r.lat||!r.lon)return null;const l=[r.lat,r.lon];return e.jsx(Ue,{position:l,ref:n,children:e.jsx(Fe,{autoPan:!0,autoClose:!1,closeOnClick:!1,children:e.jsx(St,{address:r.data?.nameFormatted?.text||r.data?.name||r.label||`${String(r.address||"")}${r.city?`, ${String(r.city)}`:""}`,lat:r.lat,lon:r.lon,routeInfo:o,userLocation:a,onClose:()=>{t&&t(null)}})})})}function Et({onAddressSelect:r,mapRef:t,selectedMarker:o,userLocation:a,routeInfo:n,currentAddress:l,speed:g,heading:h,isFullscreen:y}){const i=u.useRef(),x=t||i,b=u.useCallback(m=>{x&&(x.current=m)},[x]);return e.jsx("div",{className:"relative w-full h-full bg-gray-100",children:e.jsxs("div",{className:"w-full h-full",children:[e.jsxs(ot,{center:[47.0707,15.4395],zoom:8,className:"w-full h-full z-0",ref:b,maxZoom:18,minZoom:6,zoomControl:!1,attributionControl:!1,children:[e.jsx(at,{url:"https://maps.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png",attribution:'Datenquelle: <a href="https://www.basemap.at">basemap.at</a>',maxZoom:19}),e.jsx(jt,{}),a&&e.jsx(Tt,{position:a,address:l,speed:g,heading:h,isFullscreen:y}),o&&e.jsx(Pt,{marker:o,onAddressSelect:r,routeInfo:n,userLocation:a}),e.jsx(At,{onAddressSelect:r})]}),typeof g<"u"&&y&&e.jsx("div",{className:"absolute right-6 bottom-6 bg-white/95 backdrop-blur-sm border border-slate-300 rounded-2xl px-4 py-3 shadow-xl z-1000",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-lg text-slate-800",children:g?(g*3.6).toFixed(1):"0"}),e.jsx("span",{className:"text-sm text-slate-700 font-medium",children:"km/h"})]})})]})})}const Lt=()=>{const r=tt(),t=u.useRef(null),o=u.useRef(null),[a,n]=u.useState("night"),[l,g]=u.useState(null),[h,y]=u.useState({address:"",city:"",lat:null,lon:null}),i={night:{background:"from-slate-900 via-blue-900 to-indigo-900",accent:"from-blue-400 to-purple-400"}};u.useEffect(()=>{n("night")},[]);const x=a==="night",b=typeof window<"u"?window.innerWidth<768:!1;return u.useEffect(()=>{const m=()=>{t.current&&typeof t.current.invalidateSize=="function"&&(console.log("üó∫Ô∏è Invalidating map size..."),t.current.invalidateSize())},A=setTimeout(m,500);return window.addEventListener("resize",m),()=>{clearTimeout(A),window.removeEventListener("resize",m)}},[]),u.useEffect(()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(m=>g([m.coords.latitude,m.coords.longitude]),m=>console.warn("Geolocation error:",m))},[]),e.jsxs("div",{className:`min-h-screen bg-gradient-to-br ${i[a].background} transition-all duration-1000`,children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx(K.div,{animate:{scale:[1,1.2,1],rotate:[0,90,0]},transition:{duration:20,repeat:1/0,ease:"linear"},className:`absolute top-20 left-10 w-96 h-96 bg-gradient-to-r ${i[a].accent} rounded-full mix-blend-multiply filter blur-3xl opacity-20`}),e.jsx(K.div,{animate:{scale:[1.2,1,1.2],rotate:[90,0,90]},transition:{duration:25,repeat:1/0,ease:"linear"},className:`absolute bottom-20 right-10 w-96 h-96 bg-gradient-to-r ${i[a].accent} rounded-full mix-blend-multiply filter blur-3xl opacity-20`})]}),e.jsx(K.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"relative z-10",children:e.jsx("div",{className:"flex items-center justify-between p-4 md:p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(K.button,{onClick:()=>r(-1),whileHover:{scale:1.05},whileTap:{scale:.95},className:`p-3 rounded-xl backdrop-blur-sm border transition-all duration-200 ${x?"bg-gray-800/90 border-gray-700 text-gray-100 hover:bg-gray-700/90":"bg-white/90 border-gray-200 text-gray-700 hover:bg-white/95"} shadow-lg hover:shadow-xl`,children:e.jsx(Ie,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-3 rounded-xl bg-gradient-to-r ${i[a].accent} shadow-lg`,children:e.jsx(Xe,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold ${x?"text-white":"text-gray-900"}`,children:"Navigacija"}),e.jsx("p",{className:`text-sm ${x?"text-gray-400":"text-gray-600"}`,children:"Mapa dostave - Austrija"})]})]})]})})}),e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:`relative z-10 ${b?"h-screen":"px-2 md:px-6 pb-2 md:pb-6"}`,children:e.jsx("div",{className:`${b?"h-full":`rounded-lg md:rounded-2xl backdrop-blur-sm border overflow-hidden shadow-2xl h-[calc(100vh-120px)] md:h-[calc(100vh-160px)] ${x?"bg-gray-800/90 border-gray-700":"bg-white/90 border-gray-200"}`}`,children:e.jsx(yt,{title:"Navigacija - Mapa dostave",mapRef:t,footerRef:o,className:"h-full w-full",style:{height:"100%",width:"100%"},address:h?.address||"",city:h?.city||"",selectedMarker:h,headerHeight:b?120:160,sidebarLayout:!b,hideSearchAndInfo:b,onNavigate:m=>{if(m&&typeof m=="object"&&typeof m.lat=="number"&&typeof m.lon=="number"){window.open(`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(`${m.lat},${m.lon}`)}&travelmode=driving`,"_blank");return}m&&window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(m)}`,"_blank")},onSearchSelect:m=>{console.log("üéØ Address selected:",m),y(m)},onLocateMe:g,children:e.jsx(Et,{onAddressSelect:m=>{console.log("üó∫Ô∏è MapView address select:",m),y(m)},mapRef:t,selectedMarker:h,userLocation:l,routeInfo:null})})})}),b&&e.jsx(K.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3,delay:.2},onClick:()=>r(-1),className:"fixed top-4 left-4 z-50 p-3 rounded-2xl bg-white/90 backdrop-blur-sm border border-gray-200/50 shadow-xl hover:shadow-2xl hover:scale-105 active:scale-95 transition-all duration-200",children:e.jsx(Ie,{className:"w-6 h-6 text-gray-700"})})]})};export{Lt as default};

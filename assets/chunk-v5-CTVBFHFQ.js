import{j as e,i as F,aa as R,m as $,z as T,Y as A}from"./chunk-v5-gv7r2pb9.js";import{a as n,u as V}from"./chunk-v5-BnSIf2SQ.js";import{s as f}from"./chunk-v5-NPu4-6jz.js";import{b as q}from"./chunk-v5-CeSZ2Knk.js";import"./chunk-v5-DgaHRPzO.js";import"./chunk-v5-CpHZO0Zi.js";const M=({message:t="Učitavanje...",size:r="medium"})=>{const i={small:"w-4 h-4",medium:"w-8 h-8",large:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:`animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 ${i[r]}`}),t&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t})]})},O=({message:t,isOpen:r,duration:i=2500,onClose:m,type:p="info"})=>{if(n.useEffect(()=>{if(!r)return;const w=setTimeout(()=>{m&&m()},i);return()=>clearTimeout(w)},[r,i,m]),!r)return null;const o={info:"bg-blue-600",success:"bg-emerald-600",error:"bg-red-600",warning:"bg-yellow-500"};return e.jsx("div",{className:"fixed bottom-6 left-1/2 z-50 transform -translate-x-1/2 flex items-center justify-center",children:e.jsx("div",{className:`px-6 py-3 rounded-xl shadow-lg text-white font-semibold transition-all duration-300 ${o[p]||o.info}`,role:"status",children:t})})};function Q(){const t=q(),r=V(),[i,m]=n.useState([]),[p,o]=n.useState(!0),[w,v]=n.useState(null),[h,x]=n.useState({open:!1,message:"",type:"info"}),[z,j]=n.useState(null),[g,k]=n.useState({isOpen:!1,url:null,fileName:null}),[P,S]=n.useState(null);n.useEffect(()=>{if(!t){r("/");return}if(t.driverRole==="admin"||t.isAdmin){j("Admini nemaju pristup platnim listama"),o(!1);return}const s=t.username||t.driverName||window.localStorage.getItem("DRIVER_NAME");if(!s){j("Ime vozača nije pronađeno."),o(!1);return}E(s.trim())},[t,r]);const E=async s=>{try{o(!0);const{data:a}=await f.from("drivers").select("ime, tura").eq("ime",s).eq("deleted",0).single();a&&S(a);const{data:u,error:l}=await f.from("payrolls").select("*").eq("driver_name",s.toLowerCase());if(l)throw l;const c=(u||[]).map(d=>({id:d.id,name:d.file_name,displayMonth:d.file_name.replace(".pdf","").replace(".PDF","").replace("_","/"),created_at:d.created_at,size:"PDF"})).sort((d,_)=>{const D=U=>{const N=U.name.match(/(\d{2})_(\d{4})/);return N?{y:parseInt(N[2]),m:parseInt(N[1])}:{y:0,m:0}},y=D(_),b=D(d);return y.y!==b.y?y.y-b.y:y.m-b.m});m(c)}catch(a){console.error("Greška:",a),j("Nije moguće učitati platne liste.")}finally{o(!1)}},L=async s=>{try{v(s.id);const a=(t.username||t.driverName).toLowerCase(),{data:u,error:l}=await f.storage.from("payroll-lists").download(`${a}/${s.name}`);if(l)throw l;const C=URL.createObjectURL(u),c=document.createElement("a");c.href=C,c.download=s.name,document.body.appendChild(c),c.click(),document.body.removeChild(c),x({open:!0,type:"success",message:"Uspješno preuzeto!"})}catch{x({open:!0,type:"error",message:"Greška pri preuzimanju."})}finally{v(null)}},I=async s=>{try{const a=(t.username||t.driverName).toLowerCase(),{data:u,error:l}=await f.storage.from("payroll-lists").createSignedUrl(`${a}/${s.name}`,60);if(l)throw l;k({isOpen:!0,url:u.signedUrl,fileName:s.name})}catch{x({open:!0,type:"error",message:"Nije moguće prikazati PDF."})}};return p?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(M,{})}):z?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-white p-6 text-center",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:z}),e.jsx("button",{onClick:()=>r("/"),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Nazad"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center gap-4",children:[e.jsx("button",{onClick:()=>r("/"),className:"text-gray-600",children:e.jsx(F,{})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Platne Liste"}),e.jsxs("p",{className:"text-gray-500",children:["Vozač: ",e.jsx("strong",{children:P?.ime||t?.username})]})]})]})}),e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:i.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-2xl shadow-sm",children:[e.jsx(R,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{children:"Nema dostupnih lista (uključujući 2026)."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(s=>e.jsxs($.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-white p-6 rounded-2xl shadow-sm border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm font-bold",children:s.displayMonth}),e.jsx("span",{className:"text-xs text-gray-400",children:s.size})]}),e.jsx("h3",{className:"font-semibold mb-4 truncate",children:s.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I(s),className:"flex-1 flex items-center justify-center gap-2 bg-gray-50 py-2 rounded-lg text-sm",children:[e.jsx(T,{size:16})," Prikaži"]}),e.jsxs("button",{onClick:()=>L(s),className:"flex-1 flex items-center justify-center gap-2 bg-green-50 text-green-700 py-2 rounded-lg text-sm",children:[e.jsx(A,{size:16})," Preuzmi"]})]})]},s.id))})}),g.isOpen&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold",children:g.fileName}),e.jsx("button",{onClick:()=>k({isOpen:!1}),className:"text-2xl",children:"×"})]}),e.jsx("iframe",{src:g.url,className:"flex-1 w-full rounded-b-2xl"})]})}),h.open&&e.jsx(O,{...h,onClose:()=>x({...h,open:!1})})]})}export{Q as default};

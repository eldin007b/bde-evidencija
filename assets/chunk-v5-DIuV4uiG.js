import{j as e,m as p,g as E,aa as N,r as T,d as $,y as G,V as A}from"./chunk-v5-4P3DX6qJ.js";import{a as l,u as V}from"./chunk-v5-BnSIf2SQ.js";import{c as O,s as k,d as _}from"./chunk-v5-D-tK2_gu.js";import{b as q}from"./chunk-v5-ButkxG_j.js";import"./chunk-v5-nyoeD1-R.js";import"./chunk-v5-CpHZO0Zi.js";const z=({message:s="Učitavanje...",size:r="medium"})=>{const i={small:"w-4 h-4",medium:"w-8 h-8",large:"w-12 h-12"};return e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("div",{className:`animate-spin rounded-full border-2 border-gray-300 border-t-blue-600 ${i[r]}`}),s&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:s})]})},B=({message:s,isOpen:r,duration:i=2500,onClose:d,type:j="info"})=>{if(l.useEffect(()=>{if(!r)return;const x=setTimeout(()=>{d&&d()},i);return()=>clearTimeout(x)},[r,i,d]),!r)return null;const n={info:"bg-blue-600",success:"bg-emerald-600",error:"bg-red-600",warning:"bg-yellow-500"};return e.jsx("div",{className:"fixed bottom-6 left-1/2 z-50 transform -translate-x-1/2 flex items-center justify-center",children:e.jsx("div",{className:`px-6 py-3 rounded-xl shadow-lg text-white font-semibold transition-all duration-300 ${n[j]||n.info}`,role:"status",children:s})})};function X(){const s=q(),r=V(),[i,d]=l.useState([]),[j,n]=l.useState(!0),[x,v]=l.useState(null),[u,g]=l.useState({open:!1,message:"",type:"info"}),[w,P]=l.useState(null),[f,D]=l.useState({isOpen:!1,url:null,fileName:null}),[o,S]=l.useState(null);l.useEffect(()=>{if(!s){r("/");return}if(s.driverRole==="admin"||s.isAdmin){P("Admini nemaju pristup platnim listama"),n(!1);return}if(!s.driverName){n(!1);return}(async()=>{try{const{data:a,error:c}=await k.from("drivers").select("ime, tura").eq("ime",s.driverName.trim()).eq("deleted",0).single();!c&&a&&S(a)}catch{}})(),C(s.driverName.trim().toLowerCase())},[s,r]);const[R,Z]=l.useState(""),C=async t=>{try{n(!0);const a=await O(t);d(a),n(!1)}catch(a){console.error("Greška pri učitavanju platnih lista:",a),P("Greška pri učitavanju platnih lista iz Supabase Storage"),n(!1)}},F=async t=>{try{v(t.id);const a=o?.ime?o.ime.trim().toLowerCase():s.driverName.trim().toLowerCase();await _(a,t.name||t.fileName),g({open:!0,type:"success",message:`Platna lista ${t.name||t.fileName} je uspješno preuzeta!`})}catch(a){console.error("Greška pri preuzimanju:",a),g({open:!0,type:"error",message:"Greška pri preuzimanju platne liste"})}finally{v(null)}},L=async t=>{const a=o?.ime?o.ime.trim().toLowerCase():s.driverName.trim().toLowerCase();console.log("[viewPayroll] folder:",a,"file:",t.name);const{data:c,error:h}=await k.storage.from("payrolls").createSignedUrl(`${a}/${t.name}`,60);console.log("[viewPayroll] Supabase result:",{data:c,error:h});const m=c?.signedUrl;m?D({isOpen:!0,url:m,fileName:t.name}):g({open:!0,type:"error",message:"PDF nije pronađen ili nije moguće prikazati."})},I=t=>new Date(t).toLocaleDateString("bs-BA",{day:"2-digit",month:"2-digit",year:"numeric"}),U=[...i].sort((t,a)=>{const c=y=>{if(!y||!y.name||typeof y.name!="string")return{year:0,month:0};const b=y.name.match(/(\d{2})_(\d{4})/);return b?{year:parseInt(b[2]),month:parseInt(b[1])}:{year:0,month:0}},h=c(t),m=c(a);return h.year!==m.year?m.year-h.year:m.month-h.month});return j?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 flex items-center justify-center",children:e.jsxs(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center",children:[e.jsx(z,{}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Učitavam platne liste..."})]})}):w?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 flex items-center justify-center",children:e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl shadow-xl p-8 text-center max-w-md mx-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-2xl",children:"⚠️"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Greška"}),e.jsx("p",{className:"text-gray-600 mb-6",children:w}),e.jsx("button",{className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>r("/"),children:"Nazad na početnu"})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50",children:[e.jsx(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-white/80 backdrop-blur-sm border-b border-gray-200/60 p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center gap-4",children:[e.jsxs("button",{className:"flex items-center gap-2 text-gray-600 hover:text-gray-800 transition-colors",onClick:()=>r("/"),children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Nazad"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(N,{className:"w-6 h-6 text-blue-600"}),"Platne Liste"]}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(T,{className:"w-4 h-4"}),"Vozač: ",e.jsx("strong",{children:o?.ime||s?.name||s?.driverName}),o?.tura?e.jsxs("span",{className:"text-sm",children:["(",o.tura,")"]}):null]})]})]})}),e.jsx("div",{className:"max-w-6xl mx-auto p-6",children:i.length===0?e.jsxs(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-white rounded-2xl shadow-sm p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(N,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Nema dostupnih platnih lista"}),e.jsx("p",{className:"text-gray-600",children:"Trenutno nema uploadovanih platnih lista za vaš ID vozača."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:U.map((t,a)=>e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1},className:"bg-white rounded-2xl shadow-sm hover:shadow-md transition-all duration-200 overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-sm font-medium",children:[e.jsx($,{className:"w-4 h-4"}),t.month]}),e.jsx("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:t.size})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-2xl flex items-center justify-center mx-auto mb-3",children:e.jsx(N,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"font-semibold text-gray-800 mb-1",children:t.name}),t.created_at&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Uploaded: ",I(t.created_at)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 bg-blue-50 text-blue-600 py-2 px-4 rounded-lg hover:bg-blue-100 transition-colors",onClick:()=>L(t),title:"Prikaži PDF",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Prikaži"})]}),e.jsx("button",{className:`flex-1 flex items-center justify-center gap-2 py-2 px-4 rounded-lg transition-colors ${x===t.id?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-green-50 text-green-600 hover:bg-green-100"}`,onClick:()=>F(t),disabled:x===t.id,children:x===t.id?e.jsxs(e.Fragment,{children:[e.jsx(z,{size:"small"}),e.jsx("span",{className:"text-sm",children:"Preuzimam..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Preuzmi"})]})})]})]})},t.id))})}),u.open&&e.jsx(B,{isOpen:u.open,message:u.message,type:u.type,onClose:()=>g({...u,open:!1})}),f.isOpen&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full p-6 relative flex flex-col",children:[e.jsx("button",{className:"absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-xl",onClick:()=>D({isOpen:!1,url:null,fileName:null}),title:"Zatvori",children:"×"}),e.jsx("h3",{className:"text-lg font-bold mb-4",children:f.fileName||"PDF Dokument"}),e.jsx("iframe",{src:f.url,className:"w-full h-[70vh] border rounded-lg",title:f.fileName||"PDF Dokument",frameBorder:"0"})]})})]})}export{X as default};
